******************************************************* ADMIN FUNCTIONAL REQUIREMENTS**************************************************************************

------------------------------------------------- REGISTER FORM ----------------------------------------------------------

Imports MySql.Data.MySqlClient

Public Class register
    Dim conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet

    Private Sub createacc_Click(sender As Object, e As EventArgs) Handles createacc.Click
        Try
            Dim firstname = TextBox1.Text
            Dim lastname = TextBox2.Text
            Dim phone_no = TextBox3.Text
            Dim email_add = TextBox4.Text
            Dim password = TextBox5.Text
            Dim sex = ComboBox1.Text
            Dim bday = DateTimePicker1.Value.ToString("yyyy-MM-dd")

            conn.Open()
            sql = $"INSERT INTO customers (firstname, lastname, sex, birthdate, phone_no, email_add, password) VALUES 
       ('{firstname}', '{lastname}', '{sex}', '{bday}','{phone_no}', '{email_add}', SHA1('{password}'))"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery()

            If i > 0 Then
                MsgBox("User account created successfully.")
                standard_rooms.Show()
                Me.Hide()
            Else
                MsgBox("Account creation failed.")
            End If
        Catch ex As Exception
            MsgBox("Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub register_Load(sender As Object, e As EventArgs) Handles MyBase.Load

        ComboBox1.Items.Clear()
        ComboBox1.Items.Add("Female")
        ComboBox1.Items.Add("Male")
        ComboBox1.SelectedIndex = 0

    End Sub
End Class

--------------------------------------------------------------------------------------- LOG IN FORM ----------------------------------------------------------------------------------------------------

Imports MySql.Data.MySqlClient

Public Class login
    Dim conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles log_in.Click
        Try
            conn.Open()
            Dim email_add = TextBox1.Text
            Dim password = TextBox2.Text


            sql = "SELECT * FROM staff WHERE email_add = '" & email_add & "' AND password = '" & password & "'"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            If dbread.HasRows Then
                If dbread.Read() Then
                    MsgBox("Staff login successful!")

                    Dim deptID As Integer = Convert.ToInt32(dbread("dept_id"))

                    If deptID = 1 Then
                        admin_buttons.Show()
                    ElseIf deptID = 2 Then
                        frontdeskstaff_buttons.Show()
                    ElseIf deptID = 3 Then
                        kitchen_buttons.Show()
                    ElseIf deptID = 4 Then
                        equipmentstaff_buttons.Show()
                    End If

                    acc_database.Show()
                    Me.Hide()
                End If

                dbread.Close()
                conn.Close()
                Exit Sub
            End If

            dbread.Close()

            sql = "SELECT * FROM customers WHERE email_add = '" & email_add & "' AND password = SHA1('" & password & "')"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            If (dbread.Read) Then
                Me.Hide()

                standard_rooms.Show()
            Else
                MsgBox("invalid email or password")
            End If



        Catch ex As MySqlException
            MsgBox(ex.Message)

            conn.Close()
        Catch ex As Exception
            MsgBox(ex.Message)

            conn.Close()
        End Try
        conn.Close()
    End Sub
End Class

                                        ----------------------------------------------------------------------------
                                                                        SUPPLIERS
                                        ----------------------------------------------------------------------------



Imports MySql.Data.MySqlClient
Public Class suppliers
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Dim supplierID = Val(ComboBox1.SelectedItem)
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = "SELECT * FROM suppliers WHERE supplier_id = '" & supplierID & "'"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            If dbread.Read() Then
                TextBox1.Text = dbread("name")
                TextBox2.Text = dbread("contact_person")
                TextBox3.Text = dbread("contact_no")
                TextBox4.Text = dbread("address")
                ComboBox2.Text = dbread("category")
            End If
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally

            conn.Close()
        End Try
    End Sub

    Private Sub suppliers_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = "SELECT * FROM suppliers"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "suppliers")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "suppliers"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("supplier_id"))
            End While
            dbread.Close()

            ComboBox2.Items.Clear()
            ComboBox2.Items.Add("Food")
            ComboBox2.Items.Add("Equipment")
            ComboBox2.SelectedIndex = 0
        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Dim name = TextBox1.Text
        Dim contactper = TextBox2.Text
        Dim contactno = TextBox3.Text
        Dim address = TextBox4.Text
        Dim category = ComboBox2.SelectedItem.ToString()
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = $"INSERT INTO suppliers (name, contact_person, contact_no, address, category) VALUES ('{name}','{contactper}', '{contactno}', '{address}', '{category}')"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery
            If (i > 0) Then
                MsgBox("record saved")
                sql = "SELECT supplier_id FROM suppliers"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()

                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("supplier_id").ToString())
                End While
                dbread.Close()

            Else
                MsgBox("record not saved")
            End If
        Catch ex As MySqlException
            MsgBox("supplier not inserted")
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub


    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Dim supplierID = Val(ComboBox1.SelectedItem)
        Dim name = TextBox1.Text
        Dim contactper = TextBox2.Text
        Dim contactno = TextBox3.Text
        Dim address = TextBox4.Text
        Dim category = ComboBox2.SelectedItem.ToString()
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = $"UPDATE suppliers SET name = '{name}', contact_person = '{contactper}', contact_no = '{contactno}', address = '{address}', category = '{category}' WHERE supplier_id = {supplierID}"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery
            If (i > 0) Then
                MsgBox("record updated")
            Else
                MsgBox("record not updated")
            End If
        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            Dim address = TextBox4.Text
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim supplierID = Val(ComboBox1.SelectedItem)
            sql = $"SELECT * FROM suppliers WHERE supplier_id = {supplierID}"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "suppliers")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "suppliers"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            dbread.Close()
        Catch ex As Exception
            MsgBox("Error in collecting data from Database. Error is :" & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim query As String = "SELECT * FROM suppliers"
            adapter = New MySqlDataAdapter(query, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        TextBox1.Text = ""
        TextBox2.Text = ""
        TextBox3.Text = ""
        TextBox4.Text = ""
        ComboBox1.SelectedIndex = -1
        ComboBox2.SelectedIndex = -1
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim supplierID = Val(ComboBox1.SelectedItem)
        Dim i As Integer
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim ans = MessageBox.Show("do you want to delete this record?", "record deleted", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM suppliers WHERE supplier_id = {supplierID}"
                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery
                If (i > 0) Then
                    MsgBox("supplier deleted")
                Else
                    MsgBox("supplier not deleted")
                End If
            End If
            TextBox1.Clear()
            TextBox2.Clear()
            TextBox3.Clear()
            TextBox4.Clear()
            ComboBox1.SelectedIndex = -1
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub

    Private Sub Button8_Click(sender As Object, e As EventArgs) Handles Button8.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM suppliers WHERE category = 'Equipment'"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "suppliers")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "suppliers"

        Catch ex As Exception
            MsgBox("Error showing Equipment suppliers: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button9_Click(sender As Object, e As EventArgs) Handles Button9.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM suppliers WHERE category = 'Food'"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "suppliers")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "suppliers"

        Catch ex As Exception
            MsgBox("Error showing Equipment suppliers: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub
End Class




                                        ----------------------------------------------------------------------------
                                                                   CUSTOMER ACCOUNTS
                                        ----------------------------------------------------------------------------













Imports MySql.Data.MySqlClient

Public Class acc_database
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub acc_database_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            conn.Open()

            sql = $"SELECT * FROM customers"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "customers")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "customers"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("customer_id"))
            End While
            dbread.Close()
            ComboBox2.Items.Clear()
            ComboBox2.Items.Add("Female")
            ComboBox2.Items.Add("Male")
            ComboBox2.SelectedIndex = 0

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            Dim customerID = Val(ComboBox1.SelectedItem)
            conn.Open()

            sql = $"SELECT * FROM customers WHERE customer_id = {customerID}"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "customers")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "customers"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            While dbread.Read()
                ComboBox1.Items.Add(dbread("customer_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error in collecting data from Database. Error is :" & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub


    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Dim firstName = TextBox1.Text
        Dim lastName = TextBox2.Text
        Dim phone = TextBox4.Text
        Dim email = TextBox3.Text
        Dim sex = ComboBox2.SelectedItem.ToString()
        Dim birthdate = DateTimePicker1.Value.ToString("yyyy-MM-dd")
        Dim customerID = Val(ComboBox1.SelectedItem)

        Try
            conn.Open()

            sql = $"UPDATE customers SET firstname = '{firstName}', lastname = '{lastName}', email_add = '{email}', phone_no = '{phone}', 
sex = '{sex}', birthdate = '{birthdate}' WHERE customer_id = {customerID}"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery()

            If i > 0 Then
                MsgBox("Record updated successfully.")
            Else
                MsgBox("Record not updated.")
            End If

        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub



    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Dim customerID = Val(ComboBox1.SelectedItem)
        Try
            conn.Open()
            sql = "SELECT * FROM customers WHERE customer_id = " & customerID

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            If dbread.Read() Then
                TextBox1.Text = dbread("firstname").ToString()
                TextBox2.Text = dbread("lastname").ToString()
                TextBox3.Text = dbread("email_add").ToString()
                TextBox4.Text = dbread("phone_no").ToString()
                ComboBox2.SelectedItem = dbread("sex").ToString()
                DateTimePicker1.Value = Convert.ToDateTime(dbread("birthdate"))
            End If
            dbread.Close()

        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)

        End Try
        conn.Close()

    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            conn.Open()
            Dim query As String = "SELECT * FROM customers"
            adapter = New MySqlDataAdapter(query, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        TextBox1.Clear()
        TextBox2.Clear()
        TextBox3.Clear()
        TextBox4.Clear()
        TextBox5.Clear()
        ComboBox1.SelectedIndex = -1
        ComboBox2.SelectedIndex = -1
        DateTimePicker1.Value = DateTime.Now
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Dim firstName = TextBox1.Text
        Dim lastName = TextBox2.Text
        Dim phone = TextBox4.Text
        Dim email = TextBox3.Text
        Dim sex = ComboBox2.SelectedItem.ToString()
        Dim birthdate = DateTimePicker1.Value.ToString("yyyy-MM-dd")
        Dim customerID = Val(ComboBox1.SelectedItem)
        Dim password = TextBox5.Text

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"INSERT INTO customers (customer_id, firstname, lastname, sex, birthdate, phone_no, email_add, password)
VALUES({customerID}, '{firstName}', '{lastName}', '{sex}', '{birthdate}',  '{phone}', '{email}', SHA1('{password}'))"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("Record saved successfully.")
                sql = "SELECT customer_id FROM customers"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()

                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("customer_id").ToString())
                End While
                dbread.Close()

            Else
                MsgBox("Record not saved.")
            End If

        Catch ex As MySqlException
            MsgBox("Department not created. Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Dim customerID = Val(ComboBox1.SelectedItem)
        Dim i As Integer

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim ans = MessageBox.Show("do you want to delete this record?", "record deleted", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM customers WHERE customer_id = {customerID}"
                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("customer deleted")
                Else
                    MsgBox("customer not deleted")
                End If
            End If
            TextBox1.Clear()
            TextBox2.Clear()
            TextBox3.Clear()
            TextBox4.Clear()
            TextBox5.Clear()
            ComboBox1.SelectedIndex = -1
            ComboBox2.SelectedIndex = -1
            DateTimePicker1.Value = DateTime.Now
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)

        End Try
        conn.Close()
    End Sub
End Class









                                        ----------------------------------------------------------------------------
                                                                         CUSTOMER LOGS
                                        ----------------------------------------------------------------------------










Imports MySql.Data.MySqlClient

Public Class customer_logs
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub customer_logs_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            conn.Open()

            sql = "SELECT  " &
                  "cl.log_id, " &
                  "CONCAT(c.firstname, ' ', c.lastname) AS customer_name, " &
                  "cl.action, " &
                  "DATE_FORMAT(cl.log_timestamp, '%Y-%m-%d %H:%i:%s') AS log_timestamp, " &
                  "r.room_no, " &
                  "r.room_type, " &
                  "cl.reservation_id " &
                  "FROM customer_logs cl " &
                  "INNER JOIN room_reservations rr ON cl.reservation_id = rr.reservation_id " &
                  "INNER JOIN customers c ON rr.customer_id = c.customer_id " &
                  "INNER JOIN rooms r ON rr.room_id = r.room_id"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "customer_logs")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "customer_logs"

            sql = "SELECT log_id FROM customer_logs"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox1.Items.Clear()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("log_id").ToString())
            End While
            dbread.Close()

            sql = "SELECT reservation_id FROM room_reservations"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox3.Items.Clear()
            While dbread.Read()
                ComboBox3.Items.Add(dbread("reservation_id").ToString())
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Try
            If ComboBox1.SelectedItem Is Nothing OrElse ComboBox1.Text = "" Then Exit Sub

            conn.Open()
            sql = $"SELECT reservation_id FROM customer_logs WHERE log_id = {ComboBox1.Text}"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            If dbread.Read() Then
                ComboBox3.Text = dbread("reservation_id").ToString()
            End If
        Catch ex As Exception
            MsgBox("Error: " & ex.Message)
        Finally
            dbread.Close()
            conn.Close()
        End Try
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            conn.Open()
            sql = "SELECT  " &
                  "cl.log_id, " &
                  "CONCAT(c.firstname, ' ', c.lastname) AS customer_name, " &
                  "cl.action, " &
                  "DATE_FORMAT(cl.log_timestamp, '%Y-%m-%d %H:%i:%s') AS log_timestamp, " &
                  "r.room_no, " &
                  "r.room_type, " &
                  "cl.reservation_id " &
                  "FROM customer_logs cl " &
                  "INNER JOIN room_reservations rr ON cl.reservation_id = rr.reservation_id " &
                  "INNER JOIN customers c ON rr.customer_id = c.customer_id " &
                  "INNER JOIN rooms r ON rr.room_id = r.room_id"
            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            conn.Open()
            sql = "SELECT  " &
                  "cl.log_id, " &
                  "CONCAT(c.firstname, ' ', c.lastname) AS customer_name, " &
                  "cl.action, " &
                  "DATE_FORMAT(cl.log_timestamp, '%Y-%m-%d %H:%i:%s') AS log_timestamp, " &
                  "r.room_no, " &
                  "r.room_type, " &
                  "cl.reservation_id " &
                  "FROM customer_logs cl " &
                  "INNER JOIN room_reservations rr ON cl.reservation_id = rr.reservation_id " &
                  "INNER JOIN customers c ON rr.customer_id = c.customer_id " &
                  "INNER JOIN rooms r ON rr.room_id = r.room_id " &
                  $"WHERE cl.log_id = {ComboBox1.Text}"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "customer_logs")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "customer_logs"
        Catch ex As Exception
            MsgBox("Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Try
            conn.Open()
            sql = $"INSERT INTO customer_logs (reservation_id, action, log_timestamp) VALUES ({ComboBox3.Text}, 'check-in', NOW())"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery()
            If i > 0 Then
                MsgBox("check-in recorded")
                sql = "SELECT log_id FROM customer_logs"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()
                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("log_id").ToString())
                End While
                dbread.Close()
            Else
                MsgBox("check-in not recorded")
            End If
        Catch ex As Exception
            MsgBox("Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Try
            conn.Open()
            sql = $"INSERT INTO customer_logs (reservation_id, action, log_timestamp) VALUES ({ComboBox3.Text}, 'check-out', NOW())"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery()
            If i > 0 Then
                MsgBox("check-out recorded")
            Else
                MsgBox("check-out not recorded")
            End If
        Catch ex As Exception
            MsgBox("Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Try
            Dim ans = MessageBox.Show("Do you want to delete this record?", "Confirm Delete", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                conn.Open()
                sql = $"DELETE FROM customer_logs WHERE log_id = {ComboBox1.Text}"
                dbcomm = New MySqlCommand(sql, conn)
                Dim i As Integer = dbcomm.ExecuteNonQuery()
                If i > 0 Then
                    MsgBox("log deleted")
                Else
                    MsgBox("log not deleted")
                End If
            End If
            ComboBox1.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
        Catch ex As Exception
            MsgBox("Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        ComboBox1.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
    End Sub
End Class








                                        ----------------------------------------------------------------------------
                                                                        ROOMS
                                        ----------------------------------------------------------------------------









Imports MySql.Data.MySqlClient

Public Class rooms
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()
    Private Sub alerts()
        For Each row As DataGridViewRow In DataGridView1.Rows
            If row.IsNewRow Then Continue For

            Dim status = row.Cells("status").Value

            If status = "Not Available" Then
                row.DefaultCellStyle.BackColor = Color.Red
                row.DefaultCellStyle.ForeColor = Color.White
            Else
                row.DefaultCellStyle.BackColor = Color.White
                row.DefaultCellStyle.ForeColor = Color.Black
            End If
        Next
    End Sub
    Private Sub rooms_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM rooms"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "rooms")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "rooms"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("room_id"))
            End While
            dbread.Close()
            conn.Close()
        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        End Try
        ComboBox2.Items.Clear()
        ComboBox2.Items.Add("Standard Room")
        ComboBox2.Items.Add("Deluxe Room")
        ComboBox2.Items.Add("Party Room")
        ComboBox2.Items.Add("VIP Room")
        ComboBox2.SelectedIndex = 0

        ComboBox3.Items.Clear()
        ComboBox3.Items.Add("Available")
        ComboBox3.Items.Add("Not Available")
        ComboBox3.SelectedIndex = 0

        alerts()
    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Dim roomID As String = ComboBox1.Text
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM rooms WHERE room_id = '" & roomID & "'"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            If dbread.Read() Then
                TextBox1.Text = dbread("room_no")
                TextBox2.Text = dbread("hourly_rate")
                TextBox3.Text = dbread("capacity")
                TextBox4.Text = dbread("duration")
                ComboBox2.Text = dbread("room_type")
                ComboBox3.Text = dbread("status")
            End If
            dbread.Close()
            conn.Close()
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
        alerts()
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim query As String = "SELECT * FROM rooms"
            adapter = New MySqlDataAdapter(query, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim roomID = Val(ComboBox1.SelectedItem)
            sql = $"SELECT * FROM rooms WHERE room_id = {roomID}"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "rooms")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "rooms"

            conn.Close()
        Catch ex As Exception
            MsgBox("Error in collecting data from Database. Error is :" & ex.Message)
        End Try
        alerts()
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Dim roomno = TextBox1.Text
        Dim hourlyrate = TextBox2.Text
        Dim capacity = TextBox3.Text
        Dim roomtype = ComboBox2.SelectedItem.ToString
        Dim duration = TextBox4.Text
        Dim status = ComboBox3.SelectedItem.ToString

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"INSERT INTO rooms (room_type, room_no, hourly_rate, capacity, duration, status) VALUES ('{roomtype}','{roomno}', '{hourlyrate}','{capacity}',  '{duration}', '{status}')"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery
            conn.Close()

            If (i > 0) Then
                MsgBox("record saved")
                sql = "SELECT room_id FROM rooms"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()

                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("room_id").ToString())
                End While
                dbread.Close()

            Else
                MsgBox("record not saved")
            End If
        Catch ex As MySqlException
            MsgBox("room not inserted")
        End Try
        alerts()
    End Sub

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Dim roomno = TextBox1.Text
        Dim hourlyrate = TextBox2.Text
        Dim capacity = TextBox3.Text
        Dim roomtype = ComboBox2.SelectedItem.ToString
        Dim roomID = Val(ComboBox1.SelectedItem)
        Dim status = ComboBox3.SelectedItem.ToString
        Dim duration = TextBox4.Text

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"UPDATE rooms SET room_type = '{roomtype}', room_no = '{roomno}', hourly_rate = '{hourlyrate}', capacity = '{capacity}', duration = '{duration}',
             status = '{status}' WHERE room_id = {roomID}"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery
            conn.Close()

            If (i > 0) Then
                MsgBox("record updated")
            Else
                MsgBox("record not updated")
            End If
        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        End Try
        alerts()
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim roomID = Val(ComboBox1.SelectedItem)
            Dim i As Integer
            Dim ans = MessageBox.Show("do you want to delete this record?", "record deleted", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM rooms WHERE room_id = {roomID}"
                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("room deleted")
                Else
                    MsgBox("room not deleted")
                End If
            End If

            TextBox1.Clear()
            TextBox2.Clear()
            TextBox3.Clear()
            TextBox4.Clear()

            ComboBox2.SelectedIndex = -1
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        TextBox1.Text = ""
        TextBox2.Text = ""
        TextBox3.Text = ""
        TextBox4.Text = ""
        ComboBox1.SelectedIndex = -1
        ComboBox2.SelectedIndex = -1
    End Sub

    Private Sub Button9_Click(sender As Object, e As EventArgs) Handles Button9.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub
End Class












------------------------------------------------ SUPPLIERS ------------------------------------------------------------












Imports MySql.Data.MySqlClient
Public Class suppliers
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Dim supplierID = Val(ComboBox1.SelectedItem)
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = "SELECT * FROM suppliers WHERE supplier_id = '" & supplierID & "'"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            If dbread.Read() Then
                TextBox1.Text = dbread("name")
                TextBox2.Text = dbread("contact_person")
                TextBox3.Text = dbread("contact_no")
                TextBox4.Text = dbread("address")
                ComboBox2.Text = dbread("category")
            End If
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally

            conn.Close()
        End Try
    End Sub

    Private Sub suppliers_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = "SELECT * FROM suppliers"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "suppliers")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "suppliers"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("supplier_id"))
            End While
            dbread.Close()

            ComboBox2.Items.Clear()
            ComboBox2.Items.Add("Food")
            ComboBox2.Items.Add("Equipment")
            ComboBox2.SelectedIndex = 0
        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Dim name = TextBox1.Text
        Dim contactper = TextBox2.Text
        Dim contactno = TextBox3.Text
        Dim address = TextBox4.Text
        Dim category = ComboBox2.SelectedItem.ToString
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = $"INSERT INTO suppliers (name, contact_person, contact_no, address, category) VALUES ('{name}','{contactper}', '{contactno}', '{address}', '{category}')"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery
            If (i > 0) Then
                MsgBox("record saved")
            Else
                MsgBox("record not saved")
            End If
        Catch ex As MySqlException
            MsgBox("supplier not inserted")
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub ComboBox2_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox2.SelectedIndexChanged
        Dim category As String = ComboBox2.Text
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = "SELECT * FROM suppliers WHERE category = '" & category & "'"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            dbread.Read()
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Dim supplierID = Val(ComboBox1.SelectedItem)
        Dim name = TextBox1.Text
        Dim contactper = TextBox2.Text
        Dim contactno = TextBox3.Text
        Dim address = TextBox4.Text
        Dim category = ComboBox2.SelectedItem.ToString
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = $"UPDATE suppliers SET name = '{name}', contact_person = '{contactper}', contact_no = '{contactno}', address = '{address}', category = '{category}' WHERE supplier_id = {supplierID}"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery
            If (i > 0) Then
                MsgBox("record updated")
            Else
                MsgBox("record not updated")
            End If
        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            Dim address = TextBox4.Text
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim supplierID = Val(ComboBox1.SelectedItem)
            sql = $"SELECT * FROM suppliers WHERE supplier_id = {supplierID}"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "suppliers")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "suppliers"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            dbread.Close()
        Catch ex As Exception
            MsgBox("Error in collecting data from Database. Error is :" & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim query As String = "SELECT * FROM suppliers"
            adapter = New MySqlDataAdapter(query, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        TextBox1.Text = ""
        TextBox2.Text = ""
        TextBox3.Text = ""
        TextBox4.Text = ""
        ComboBox1.SelectedIndex = -1
        ComboBox2.SelectedIndex = -1
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim supplierID = Val(ComboBox1.SelectedItem)
        Dim i As Integer
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim ans = MessageBox.Show("do you want to delete this record?", "record deleted", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM suppliers WHERE supplier_id = {supplierID}"
                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery
                If (i > 0) Then
                    MsgBox("supplier deleted")
                Else
                    MsgBox("supplier not deleted")
                End If
            End If
            TextBox1.Clear()
            TextBox2.Clear()
            TextBox3.Clear()
            TextBox4.Clear()
            ComboBox1.SelectedIndex = -1
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button8_Click(sender As Object, e As EventArgs) Handles Button8.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM suppliers WHERE category = 'Equipment'"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "suppliers")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "suppliers"

        Catch ex As Exception
            MsgBox("Error showing Equipment suppliers: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button9_Click(sender As Object, e As EventArgs) Handles Button9.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM suppliers WHERE category = 'Food'"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "suppliers")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "suppliers"

        Catch ex As Exception
            MsgBox("Error showing Equipment suppliers: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub
End Class












                                        ----------------------------------------------------------------------------
                                                                   FOOD INVENTORY
                                        ----------------------------------------------------------------------------









Imports MySql.Data.MySqlClient
Public Class food_inventory
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub alerts()
        For Each row As DataGridViewRow In DataGridView1.Rows
            If row.IsNewRow Then Continue For

            Dim status = row.Cells("status").Value
            Dim quantity = row.Cells("quantity").Value
            Dim expDate = row.Cells("expiration_date").Value

            If expDate IsNot Nothing AndAlso CDate(expDate).Date = Today Then
                row.Cells("status").Value = "expired"
                row.DefaultCellStyle.BackColor = Color.Red
                row.DefaultCellStyle.ForeColor = Color.Black

            ElseIf IsNumeric(quantity) AndAlso Val(quantity) <= 2 Then
                row.DefaultCellStyle.BackColor = Color.Orange
                row.DefaultCellStyle.ForeColor = Color.White
            End If
        Next
    End Sub


    Private Sub food_inventory_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM food_inventory"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "food_inventory")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "food_inventory"

            sql = "SELECT food_id FROM food_inventory ORDER BY food_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("food_id"))
            End While
            dbread.Close()

            alerts()

            sql = "SELECT supplier_id FROM suppliers ORDER BY supplier_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox3.Items.Clear()
            While dbread.Read()
                ComboBox3.Items.Add(dbread("supplier_id"))
            End While
            dbread.Close()

            ComboBox4.Items.Clear()
            ComboBox4.Items.Add("Fresh")
            ComboBox4.Items.Add("Expired")
            ComboBox4.Items.Add("Low Stock!")
            ComboBox4.SelectedIndex = 0

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Dim foodID = Val(ComboBox1.SelectedItem)

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"SELECT * FROM food_inventory WHERE food_id = {foodID}"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            If dbread.Read() Then
                TextBox1.Text = dbread("name")
                TextBox2.Text = dbread("quantity").ToString()
                TextBox3.Text = dbread("unit")
                DateTimePicker1.Value = Convert.ToDateTime(dbread("last_restock"))
                DateTimePicker2.Value = Convert.ToDateTime(dbread("expiration_date"))
                ComboBox4.Text = dbread("status")
                ComboBox3.Text = dbread("supplier_id")
            End If

        Catch ex As Exception
            MsgBox("Error loading inventory details: " & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Dim name = TextBox1.Text
        Dim quantity = Val(TextBox2.Text)
        Dim units = TextBox3.Text
        Dim last_restock = DateTimePicker1.Value.ToString("yyyy-MM-dd")
        Dim expiration_date = DateTimePicker2.Value.ToString("yyyy-MM-dd")
        Dim status = ComboBox4.Text
        Dim supplierID = Val(ComboBox3.Text)

        Dim i As Integer = 0
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = $"INSERT INTO food_inventory (supplier_id, name, quantity, unit, last_restock, expiration_date, status) VALUES( 
            {supplierID}, '{name}', {quantity}, '{units}', '{last_restock}', '{expiration_date}', '{status}')"

            dbcomm = New MySqlCommand(sql, conn)
            i = dbcomm.ExecuteNonQuery


            If (i > 0) Then
                MsgBox("Record saved successfully.")
                sql = "SELECT food_id FROM food_inventory"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()

                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("food_id").ToString())
                End While
                dbread.Close()

            Else
                MsgBox("Record not saved.")
            End If

        Catch ex As MySqlException
            MsgBox("Ingredient not added. Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim query As String = "SELECT * FROM food_inventory"
            adapter = New MySqlDataAdapter(query, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table

            ComboBox1.Items.Clear()
            sql = "SELECT food_id FROM food_inventory ORDER BY food_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("food_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub


    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim foodID = Val(ComboBox1.SelectedItem)

            sql = $" SELECT * FROM food_inventory WHERE food_id = {foodID}"

            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "food_inventory")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "food_inventory"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            If dbread.HasRows Then dbread.Read()
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error in collecting data from Database. Error is :" & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Dim name = TextBox1.Text
        Dim quantity = Val(TextBox2.Text)
        Dim units = TextBox3.Text
        Dim last_restock = DateTimePicker1.Value.ToString("yyyy-MM-dd")
        Dim expiration_date = DateTimePicker2.Value.ToString("yyyy-MM-dd")
        Dim status = ComboBox4.SelectedItem.ToString()
        Dim supplierID = Val(ComboBox3.SelectedItem)
        Dim foodID = Val(ComboBox1.SelectedItem)
        Dim i As Integer = 0

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = $"UPDATE food_inventory SET supplier_id = {supplierID}, name = '{name}', quantity = {quantity}, unit = '{units}', last_restock = '{last_restock}',
expiration_date = '{expiration_date}', status = '{status}' WHERE food_id = {foodID}"

            dbcomm = New MySqlCommand(sql, conn)
            i = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("record updated")
            Else
                MsgBox("record Not updated")
            End If

        Catch ex As Exception
            MsgBox("Error updating record:  " & ex.Message)
        End Try
        alerts()
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim foodID = Val(ComboBox1.SelectedItem)
        Dim i As Integer
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim ans = MessageBox.Show("do you want to delete this record?", "record deleted", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM food_inventory WHERE food_id = {foodID}"
                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("food deleted")
                Else
                    MsgBox("food not deleted")
                End If
            End If
            TextBox1.Text = ""
            TextBox2.Text = ""
            TextBox3.Text = ""
            ComboBox1.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
            ComboBox4.SelectedIndex = -1
            DateTimePicker1.Value = DateTime.Now
            DateTimePicker2.Value = DateTime.Now
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)

        End Try
        conn.Close()
        alerts()
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        TextBox1.Text = ""
        TextBox2.Text = ""
        TextBox3.Text = ""
        ComboBox1.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
        ComboBox4.SelectedIndex = -1
        DateTimePicker1.Value = DateTime.Now
        DateTimePicker2.Value = DateTime.Now
        alerts()
    End Sub

    Private Sub Button8_Click(sender As Object, e As EventArgs) Handles Button8.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub
End Class






                                        ----------------------------------------------------------------------------
                                                                     EQUIPMENT INVENTORY
                                        ----------------------------------------------------------------------------











Imports MySql.Data.MySqlClient

Public Class equipment_inventory
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub alerts()
        For Each row As DataGridViewRow In DataGridView1.Rows
            If row.IsNewRow Then Continue For

            Dim status = row.Cells("status").Value
            Dim quantity = row.Cells("quantity").Value

            If status = "Broken" Then
                row.DefaultCellStyle.BackColor = Color.Red
                row.DefaultCellStyle.ForeColor = Color.Black
            ElseIf status = "Under Repair" Then
                row.DefaultCellStyle.BackColor = Color.Blue
                row.DefaultCellStyle.ForeColor = Color.White
            ElseIf Val(quantity) < 2 Then
                row.DefaultCellStyle.BackColor = Color.Orange
                row.DefaultCellStyle.ForeColor = Color.Black
            End If
        Next
    End Sub

    Private Sub equipment_inventory_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM equipment_inventory"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "equipment_inventory")
            DataGridView1.DataSource = ds.Tables("equipment_inventory")

            ComboBox1.Items.Clear()
            sql = "SELECT equipment_id FROM equipment_inventory ORDER BY equipment_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            If dbread IsNot Nothing AndAlso Not dbread.IsClosed Then dbread.Close()
            dbread = dbcomm.ExecuteReader()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("equipment_id"))
            End While
            dbread.Close()

            ComboBox3.Items.Clear()
            sql = "SELECT supplier_id FROM suppliers"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            While dbread.Read()
                ComboBox3.Items.Add(dbread("supplier_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
        ComboBox4.Items.Clear()
        ComboBox4.Items.AddRange({"Working", "Broken", "Under Repair"})
        ComboBox4.SelectedIndex = 0
        alerts()
    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Dim equipID = Val(ComboBox1.SelectedItem)
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"SELECT * FROM equipment_inventory WHERE equipment_id = {equipID}"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            If dbread.Read() Then
                TextBox1.Text = dbread("name")
                TextBox2.Text = dbread("quantity")
                DateTimePicker1.Value = Convert.ToDateTime(dbread("last_restock"))
                ComboBox4.Text = dbread("status")
                ComboBox3.Text = dbread("supplier_id")
            End If
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading equipment data: " & ex.Message, MsgBoxStyle.Critical)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim query As String = "SELECT * FROM equipment_inventory"
            adapter = New MySqlDataAdapter(query, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table

            alerts()

            ComboBox1.Items.Clear()
            sql = "SELECT equipment_id FROM equipment_inventory"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("equipment_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error refreshing data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim equipID = Val(ComboBox1.SelectedItem)
            Dim supplierID = Val(ComboBox3.SelectedItem)

            sql = $"SELECT * FROM equipment_inventory WHERE equipment_id = {equipID} AND supplier_id = {supplierID}"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "equipment_inventory")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "equipment_inventory"

        Catch ex As Exception
            MsgBox("Error filtering records: " & ex.Message)
        Finally
            conn.Close()
        End Try
         alerts()
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Dim name = TextBox1.Text
        Dim quantity = Val(TextBox2.Text)
        Dim last_restock = DateTimePicker1.Value.ToString("yyyy-MM-dd")
        Dim status = ComboBox4.SelectedItem.ToString()
        Dim supplierID = Val(ComboBox3.SelectedItem)

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            alerts()
            sql = $"INSERT INTO equipment_inventory (supplier_id, name, quantity, last_restock, status) VALUES( {supplierID},'{name}', {quantity}, '{last_restock}', '{status}')"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("Record saved successfully.")
                sql = "SELECT equipment_id FROM equipment_inventory"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()

                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("equipment_id").ToString())
                End While
                dbread.Close()

            Else
                MsgBox("Record not saved.")
            End If

        Catch ex As Exception
            MsgBox("Error saving record: " & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Dim name = TextBox1.Text
        Dim quantity = Val(TextBox2.Text)
        Dim last_restock = DateTimePicker1.Value.ToString("yyyy-MM-dd")
        Dim status = ComboBox4.SelectedItem.ToString()
        Dim supplierID = Val(ComboBox3.SelectedItem)
        Dim equipID = Val(ComboBox1.SelectedItem)
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            alerts()

            sql = $"UPDATE equipment_inventory SET supplier_id = {supplierID}, name = '{name}', quantity = {quantity}, last_restock = '{last_restock}', status = '{status}' WHERE equipment_id = {equipID}"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("Record updated")
            Else
                MsgBox("Record not updated")
            End If

        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim equipID = Val(ComboBox1.SelectedItem)
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim ans = MessageBox.Show("Do you want to delete this record?", "Confirm Deletion", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM equipment_inventory WHERE equipment_id = {equipID}"
                dbcomm = New MySqlCommand(sql, conn)
                Dim i As Integer = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("Equipment deleted")
                Else
                    MsgBox("Equipment not deleted")
                End If
            End If

            TextBox1.Text = ""
            TextBox2.Text = ""
            ComboBox1.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
            ComboBox4.SelectedIndex = -1
            DateTimePicker1.Value = DateTime.Now
        Catch ex As Exception
            MsgBox("Error deleting record: " & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        TextBox1.Text = ""
        TextBox2.Text = ""
        ComboBox1.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
        ComboBox4.SelectedIndex = -1
        DateTimePicker1.Value = DateTime.Now
        alerts()
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub
End Class










                                        ----------------------------------------------------------------------------
                                                      VIP LOGS
                                        ----------------------------------------------------------------------------







Imports MySql.Data.MySqlClient

Public Class vip_logs
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub vip_logs_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT  " &
                  "vl.vip_log_id, " &
                  "CONCAT(c.firstname, ' ', c.lastname) AS customer_name, " &
                  "vl.action, " &
                  "DATE_FORMAT(vl.vip_log_timestamp, '%Y-%m-%d %H:%i:%s') AS log_timestamp, " &
                  "r.room_no, " &
                  "r.room_type, " &
                  "vl.vip_reservation_id " &
                  "FROM vip_logs vl " &
                  "INNER JOIN vip_reservations vr ON vl.vip_reservation_id = vr.vip_reservation_id " &
                  "INNER JOIN customers c ON vr.customer_id = c.customer_id " &
                  "INNER JOIN rooms r ON vr.room_id = r.room_id"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "vip_logs")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "vip_logs"
            conn.Close()

            conn.Open()
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            While dbread.Read()
                ComboBox1.Items.Add(dbread("vip_log_id").ToString())
            End While
            dbread.Close()

            sql = "SELECT vip_reservation_id FROM vip_reservations"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox3.Items.Clear()
            While dbread.Read()
                ComboBox3.Items.Add(dbread("vip_reservation_id").ToString())
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        If ComboBox1.SelectedItem Is Nothing OrElse ComboBox1.Text = "" Then
            Exit Sub
        End If
        Dim viplogid As String = ComboBox1.Text
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM vip_logs WHERE vip_log_id = " & viplogid
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            dbread.Read()
            ComboBox1.Text = dbread("vip_log_id").ToString()

        Catch ex As Exception
            MsgBox("Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Dim action = "check in"
        Dim reservation_id = ComboBox3.SelectedItem.ToString()

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"INSERT INTO vip_logs (vip_reservation_id, action, vip_log_timestamp) VALUES ({reservation_id}, '{action}', NOW())"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery()

            If i > 0 Then
                MsgBox("Check-in recorded successfully.")
                sql = "SELECT vip_log_id FROM vip_logs"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()
                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("vip_log_id").ToString())
                End While
                dbread.Close()
            Else
                MsgBox("Check-in not recorded.")
            End If

        Catch ex As Exception
            MsgBox("Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Dim action = "check out"
        Dim reservation_id = ComboBox3.SelectedItem.ToString()

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"INSERT INTO vip_logs (vip_reservation_id, action, vip_log_timestamp) VALUES ({reservation_id}, '{action}', NOW())"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery()

            If i > 0 Then
                MsgBox("Check-out recorded successfully.")

                sql = $"UPDATE vip_reservations SET status = 'Completed' WHERE vip_reservation_id = {reservation_id}"
                dbcomm = New MySqlCommand(sql, conn)
                dbcomm.ExecuteNonQuery()

                sql = "SELECT vip_log_id FROM vip_logs"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()
                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("vip_log_id").ToString())
                End While
                dbread.Close()

            Else
                MsgBox("Check-out not recorded.")
            End If

        Catch ex As Exception
            MsgBox("Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            conn.Open()
            sql = "SELECT  " &
                  "vl.vip_log_id, " &
                  "CONCAT(c.firstname, ' ', c.lastname) AS customer_name, " &
                  "vl.action, " &
                  "DATE_FORMAT(vl.vip_log_timestamp, '%Y-%m-%d %H:%i:%s') AS log_timestamp, " &
                  "r.room_no, " &
                  "r.room_type, " &
                  "vl.vip_reservation_id " &
                  "FROM vip_logs vl " &
                  "INNER JOIN vip_reservations vr ON vl.vip_reservation_id = vr.vip_reservation_id " &
                  "INNER JOIN customers c ON vr.customer_id = c.customer_id " &
                  "INNER JOIN rooms r ON vr.room_id = r.room_id"
            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            conn.Open()
            sql = "SELECT  " &
                  "vl.vip_log_id, " &
                  "CONCAT(c.firstname, ' ', c.lastname) AS customer_name, " &
                  "vl.action, " &
                  "DATE_FORMAT(vl.vip_log_timestamp, '%Y-%m-%d %H:%i:%s') AS log_timestamp, " &
                  "r.room_no, " &
                  "r.room_type, " &
                  "vl.vip_reservation_id " &
                  "FROM vip_logs vl " &
                  "INNER JOIN vip_reservations vr ON vl.vip_reservation_id = vr.vip_reservation_id " &
                  "INNER JOIN customers c ON vr.customer_id = c.customer_id " &
                  "INNER JOIN rooms r ON vr.room_id = r.room_id " &
                  $"WHERE vl.vip_log_id = {ComboBox1.Text}"

            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "vip_logs")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "vip_logs"
        Catch ex As Exception
            MsgBox("Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim viplogid = ComboBox1.SelectedItem.ToString()

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim ans = MessageBox.Show("Do you want to delete this record?", "Confirm Delete", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM vip_logs WHERE vip_log_id = {viplogid}"
                dbcomm = New MySqlCommand(sql, conn)
                Dim i As Integer = dbcomm.ExecuteNonQuery()
                If i > 0 Then
                    MsgBox("Record deleted.")
                Else
                    MsgBox("Record not deleted.")
                End If
            End If

            ComboBox1.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1

        Catch ex As Exception
            MsgBox("Error deleting record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        ComboBox1.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
    End Sub

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub
End Class







                                        ----------------------------------------------------------------------------
                                                    SUPPLIER TRANSACTIONS
                                        ----------------------------------------------------------------------------












Imports MySql.Data.MySqlClient
Public Class supplier_transactions
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()
    Private Sub supplier_transactions_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM supplier_transactions"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "supplier_transactions")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "supplier_transactions"

            sql = "SELECT transaction_id FROM supplier_transactions ORDER BY transaction_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            While dbread.Read()
                ComboBox1.Items.Add(dbread("transaction_id"))
            End While
            dbread.Close()

            sql = "SELECT supplier_id FROM suppliers ORDER BY supplier_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox2.Items.Clear()
            While dbread.Read()
                ComboBox2.Items.Add(dbread("supplier_id"))
            End While
            dbread.Close()

            sql = "SELECT equipment_id FROM equipment_inventory ORDER BY equipment_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox4.Items.Clear()
            While dbread.Read()
                ComboBox4.Items.Add(dbread("equipment_id"))
            End While
            dbread.Close()

            sql = "SELECT food_id FROM food_inventory ORDER BY food_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox3.Items.Clear()
            While dbread.Read()
                ComboBox3.Items.Add(dbread("food_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
        ComboBox6.Items.Clear()
        ComboBox6.Items.Add("Food")
        ComboBox6.Items.Add("Equipment")
        ComboBox6.SelectedIndex = 0

        ComboBox5.Items.Clear()
        ComboBox5.Items.Add("Delivered")
        ComboBox5.Items.Add("Cancelled")
        ComboBox5.SelectedIndex = 0
    End Sub


    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Dim transactionID As String = ComboBox1.Text
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM supplier_transactions WHERE transaction_id = '" & transactionID & "'"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            If dbread.HasRows Then
                dbread.Read()

                TextBox1.Text = dbread("shipping_fee").ToString()
                TextBox2.Text = dbread("purchase_amount").ToString()
                TextBox3.Text = dbread("quantity").ToString()
                ComboBox5.Text = dbread("status").ToString()
                ComboBox2.Text = dbread("supplier_id").ToString()
                ComboBox6.Text = dbread("supplier_type").ToString()

                If Not IsDBNull(dbread("date_delivered")) Then
                    DateTimePicker1.Value = Convert.ToDateTime(dbread("date_delivered"))
                Else
                    DateTimePicker1.Value = DateTime.Now
                End If
            Else
                MsgBox("No data found for Transaction ID " & transactionID)
            End If

        Catch ex As MySqlException
            MsgBox("MySQL Error: " & ex.Message)
        Catch ex As Exception
            MsgBox("General Error: " & ex.Message)
        Finally
            If dbread IsNot Nothing AndAlso Not dbread.IsClosed Then dbread.Close()
            If conn.State = ConnectionState.Open Then conn.Close()
        End Try
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim query As String = "SELECT * FROM supplier_transactions"
            adapter = New MySqlDataAdapter(query, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim transactionID As Integer = Val(ComboBox1.SelectedItem)
            Dim suppliertype As String = ComboBox6.SelectedItem.ToString()

            If transactionID = 0 OrElse String.IsNullOrWhiteSpace(suppliertype) Then
                MsgBox("Please select a valid transaction and supplier type.")
                Exit Sub
            End If

            If suppliertype = "Food" Then
                sql = "SELECT st.transaction_id, st.supplier_id, ft.food_id, st.supplier_type, st.date_delivered, st.shipping_fee, " &
                  "st.purchase_amount, st.quantity, st.status " &
                  "FROM supplier_transactions st " &
                  "INNER JOIN food_transaction_details ft ON st.transaction_id = ft.transaction_id " &
                  "WHERE st.transaction_id = " & transactionID
            ElseIf suppliertype = "Equipment" Then
                sql = "SELECT st.transaction_id, st.supplier_id, et.equipment_id, st.supplier_type, st.date_delivered, st.shipping_fee, " &
                  "st.purchase_amount, st.quantity, st.status " &
                  "FROM supplier_transactions st " &
                  "INNER JOIN equipment_transaction_details et ON st.transaction_id = et.transaction_id " &
                  "WHERE st.transaction_id = " & transactionID
            Else
                MsgBox("Invalid supplier type selected.")
                Exit Sub
            End If

            adapter = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            adapter.Fill(ds, "supplier_transactions")

            DataGridView1.DataSource = ds.Tables("supplier_transactions")

        Catch ex As Exception
            MsgBox("Error collecting data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub





    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim shipping As Decimal = Convert.ToDecimal(TextBox1.Text)
            Dim purchase As Decimal = Convert.ToDecimal(TextBox2.Text)
            Dim supplierID = Val(ComboBox2.Text)
            Dim foodID = Val(ComboBox3.Text)
            Dim equipmentID = Val(ComboBox4.Text)
            Dim date_d = DateTimePicker1.Value.ToString("yyyy-MM-dd")
            Dim quantity = Val(TextBox3.Text)
            Dim status = ComboBox5.Text
            Dim suppliertype = ComboBox6.Text
            Dim transactionID As Integer
            Dim i As Integer = 0

            sql = $"INSERT INTO supplier_transactions (supplier_id, supplier_type, date_delivered, shipping_fee, purchase_amount, quantity, status) " &
              $"VALUES({supplierID}, '{suppliertype}', '{date_d}', {shipping}, {purchase}, {quantity}, '{status}')"

            dbcomm = New MySqlCommand(sql, conn)
            i = dbcomm.ExecuteNonQuery()

            If i > 0 Then
                MsgBox("Transaction record saved successfully.")

                sql = "SELECT LAST_INSERT_ID()"
                dbcomm = New MySqlCommand(sql, conn)
                transactionID = Convert.ToInt32(dbcomm.ExecuteScalar())

                If suppliertype = "Equipment" Then
                    sql = $"INSERT INTO equipment_transaction_details (transaction_id, equipment_id) VALUES({transactionID}, {equipmentID})"
                ElseIf suppliertype = "Food" Then
                    sql = $"INSERT INTO food_transaction_details (transaction_id, food_id) VALUES({transactionID}, {foodID})"
                End If

                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery()

                If i > 0 Then
                    MsgBox("Detail record saved successfully.")

                Else
                    MsgBox("Detail record not saved.")
                End If
            Else
                MsgBox("Transaction record not saved.")
            End If

        Catch ex As MySqlException
            MsgBox("Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub


    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim shipping As Decimal = Convert.ToDecimal(TextBox1.Text)
            Dim purchase As Decimal = Convert.ToDecimal(TextBox2.Text)
            Dim transactionID = Val(ComboBox1.SelectedItem)
            Dim supplierID = Val(ComboBox2.SelectedItem)
            Dim foodID = Val(ComboBox3.SelectedItem)
            Dim equipmentID = Val(ComboBox4.SelectedItem)
            Dim date_d = DateTimePicker1.Value.ToString("yyyy-MM-dd")
            Dim quantity = Val(TextBox3.Text)
            Dim status = ComboBox5.SelectedItem
            Dim suppliertype = ComboBox6.SelectedItem

            sql = $"UPDATE supplier_transactions SET supplier_id = {supplierID}, supplier_type = '{suppliertype}', 
           date_delivered = '{date_d}', shipping_fee = {shipping}, purchase_amount = {purchase}, quantity = {quantity} , status = '{status}' WHERE transaction_id = 
           {transactionID}"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("record updated")
            Else
                MsgBox("record not updated")
            End If

            If suppliertype = "Equipment" Then
                sql = $"UPDATE equipment_transaction_details SET equipment_id = {equipmentID} WHERE transaction_id = {transactionID}"

                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("Record saved successfully.")
                Else
                    MsgBox("Record not saved.")
                End If
            ElseIf suppliertype = "Food" Then
                sql = $"UPDATE food_transaction_details SET food_id = {foodID} WHERE transaction_id = {transactionID}"

                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("Record saved successfully.")
                Else
                    MsgBox("Record not saved.")
                End If
            End If

        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
            conn.Close()
        End Try

    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim transactionID As Integer = Val(ComboBox1.SelectedItem)
        Dim status As String = ComboBox5.Text
        Dim i As Integer

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            If status = "Cancelled" Then
                Dim ans = MessageBox.Show("Do you want to delete this record?", "Confirm Deletion", MessageBoxButtons.YesNoCancel, MessageBoxIcon.Warning)
                If ans = DialogResult.Yes Then
                    sql = "DELETE FROM supplier_transactions WHERE transaction_id = " & transactionID
                    dbcomm = New MySqlCommand(sql, conn)
                    i = dbcomm.ExecuteNonQuery()

                    If i > 0 Then
                        MsgBox("Supplier transaction deleted successfully.")
                    Else
                        MsgBox("No transaction was deleted.")
                    End If
                End If
            Else
                MsgBox("Only transactions with status 'Cancelled' can be deleted.")
            End If

        Catch ex As MySqlException
            MsgBox("Database error: " & ex.Message)
        Catch ex As Exception
            MsgBox("Unexpected error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        TextBox1.Clear()
        TextBox2.Clear()
        TextBox3.Clear()
        ComboBox1.SelectedIndex = -1
        ComboBox2.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
        ComboBox4.SelectedIndex = -1
        ComboBox5.SelectedIndex = -1
        ComboBox6.SelectedIndex = -1
        DateTimePicker1.Value = DateTime.Now
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub
End Class









                                        ----------------------------------------------------------------------------
                                                    VIP RESERVATIONS
                                        ----------------------------------------------------------------------------















Imports MySql.Data.MySqlClient
Public Class vip_reservations
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub alerts()
        For Each row As DataGridViewRow In DataGridView1.Rows
            If row.IsNewRow Then Continue For

            Dim status = row.Cells("status").Value

            If status = "Cancelled" Then
                row.DefaultCellStyle.BackColor = Color.Red
                row.DefaultCellStyle.ForeColor = Color.White
            ElseIf status = "No Show" Then
                row.DefaultCellStyle.BackColor = Color.OrangeRed
                row.DefaultCellStyle.ForeColor = Color.White
            ElseIf status = "Booked" Then
                row.DefaultCellStyle.BackColor = Color.Green
                row.DefaultCellStyle.ForeColor = Color.White
            ElseIf status = "Booked" Then
                row.DefaultCellStyle.BackColor = Color.White
                row.DefaultCellStyle.ForeColor = Color.Black
            End If
        Next
    End Sub
    Private Sub vip_reservations_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Closed Then conn.Open()
            sql = $"SELECT 
    vr.vip_reservation_id,
    vr.customer_id ,
    vr.room_id,
    vr.vip_perk_id,
    vr.date_reserved ,
    vr.time_reserved,
    vr.status,
    vp.vip_perk_name
FROM vip_reservations vr
INNER JOIN vip_perks vp ON vr.vip_perk_id = vp.vip_perk_id"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "vip_reservations")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "vip_reservations"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox1.Items.Clear()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("vip_reservation_id"))
            End While
            dbread.Close()

            sql = $"SELECT room_id FROM rooms"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox2.Items.Clear()
            While dbread.Read()
                ComboBox2.Items.Add(dbread("room_id"))
            End While
            dbread.Close()

            sql = $"SELECT customer_id FROM customers"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox3.Items.Clear()
            While dbread.Read()
                ComboBox3.Items.Add(dbread("customer_id"))
            End While
            dbread.Close()

            sql = $"SELECT vip_perk_id FROM vip_perks"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox4.Items.Clear()
            While dbread.Read()
                ComboBox4.Items.Add(dbread("vip_perk_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try

        ComboBox5.Items.Clear()
        ComboBox5.Items.Add("Completed")
        ComboBox5.Items.Add("Booked")
        ComboBox5.Items.Add("Cancelled")
        ComboBox5.Items.Add("No Show")
        ComboBox5.SelectedIndex = 0

        ComboBox6.Items.Clear()
        ComboBox6.Items.Add("1:00 PM - 5:00 PM")
        ComboBox6.Items.Add("6:00 PM - 10:00 PM")
        ComboBox6.Items.Add("11:00 PM - 3:00 AM")
        ComboBox6.SelectedIndex = 0

        alerts()
    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        If ComboBox1.SelectedItem Is Nothing OrElse ComboBox1.Text = "" Then
            Exit Sub
        End If
        Dim vipID = Val(ComboBox1.SelectedItem)
        Try
            If conn.State = ConnectionState.Closed Then conn.Open()

            sql = $"SELECT * FROM vip_reservations WHERE vip_reservation_id = {vipID}"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            If dbread.Read() Then
                ComboBox6.Text = dbread("time_reserved")
                DateTimePicker1.Value = Convert.ToDateTime(dbread("date_reserved"))
                ComboBox2.Text = dbread("room_id")
                ComboBox3.Text = dbread("customer_id")
                ComboBox4.Text = dbread("vip_perk_id")
                ComboBox5.Text = dbread("status")
            End If
            dbread.Close()


        Catch ex As MySqlException
            MsgBox("Database error: " & ex.Message)
        Catch ex As Exception
            MsgBox("Unexpected error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Closed Then conn.Open()

            Dim query As String = "SELECT 
    vr.vip_reservation_id,
    vr.customer_id ,
    vr.room_id,
    vr.vip_perk_id,
    vr.date_reserved ,
    vr.time_reserved,
    vr.status,
    vp.vip_perk_name
FROM vip_reservations vr
INNER JOIN vip_perks vp ON vr.vip_perk_id = vp.vip_perk_id"
            adapter = New MySqlDataAdapter(query, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table
            alerts()
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Dim vipID = Val(ComboBox1.SelectedItem)
        Dim roomID = Val(ComboBox2.SelectedItem)
        Dim customerID = Val(ComboBox3.SelectedItem)
        Dim vipPerks = ComboBox4.SelectedItem.ToString()
        Dim dateReserved = DateTimePicker1.Value.ToString("yyyy-MM-dd")
        Dim timeReserved = ComboBox6.SelectedItem.ToString()
        Dim status = ComboBox5.SelectedItem.ToString()
        Try
            If conn.State = ConnectionState.Closed Then conn.Open()

            sql = $"SELECT 
    vr.vip_reservation_id,
    vr.customer_id ,
    vr.room_id,
    vr.vip_perk_id,
    vr.date_reserved ,
    vr.time_reserved,
    vr.status,
    vp.vip_perk_name
FROM vip_reservations vr
INNER JOIN vip_perks vp ON vr.vip_perk_id = vp.vip_perk_id
 WHERE vr.vip_reservation_id = {vipID}"

            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "vip_reservations")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "vip_reservations"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            ComboBox1.Items.Clear()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("vip_reservation_id"))
            End While

            dbread.Close()
            alerts()
        Catch ex As Exception
            MsgBox("Error in collecting data from Database. Error is :" & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Dim vipID = Val(ComboBox1.SelectedItem)
        Dim roomID = Val(ComboBox2.SelectedItem)
        Dim customerID = Val(ComboBox3.SelectedItem)
        Dim vipPerks = ComboBox4.SelectedItem.ToString()
        Dim dateReserved = DateTimePicker1.Value.ToString("yyyy-MM-dd")
        Dim timeReserved = ComboBox6.SelectedItem.ToString()
        Dim status = ComboBox5.SelectedItem.ToString()

        Try
            If conn.State = ConnectionState.Closed Then conn.Open()

            sql = $"UPDATE vip_reservations SET room_id = '{roomID}', customer_id = '{customerID}', 
 vip_perk_id  = '{vipPerks}', date_reserved = '{dateReserved}', time_reserved = '{timeReserved}', status = '{status}'  
WHERE vip_reservation_id = {vipID}"


            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("record updated")
            Else
                MsgBox("record not updated")

            End If

        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim vipID = Val(ComboBox1.SelectedItem)

        Try
            If conn.State = ConnectionState.Closed Then conn.Open()

            Dim ans = MessageBox.Show("do you want to delete this record?", "record deleted", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM vip_reservations WHERE vip_reservation_id = {vipID}"

                dbcomm = New MySqlCommand(sql, conn)
                Dim i As Integer = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("vip reservation deleted")
                Else
                    MsgBox("vip reservation not deleted")
                End If
            End If
            ComboBox6.SelectedIndex = -1
            ComboBox1.SelectedIndex = -1
            ComboBox2.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
            ComboBox4.SelectedIndex = -1
            ComboBox5.SelectedIndex = -1
            DateTimePicker1.Value = DateTime.Now
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        ComboBox6.SelectedIndex = -1
        ComboBox1.SelectedIndex = -1
        ComboBox2.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
        ComboBox4.SelectedIndex = -1
        ComboBox5.SelectedIndex = -1
        DateTimePicker1.Value = DateTime.Now
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub


    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click

        Dim roomID = Val(ComboBox2.Text)
        Dim customerID = Val(ComboBox3.Text)
        Dim vipPerks = ComboBox4.SelectedItem.ToString()
        Dim dateReserved = DateTimePicker1.Value.ToString("yyyy-MM-dd")
        Dim timeReserved = ComboBox6.SelectedItem.ToString()
        Dim status = ComboBox5.SelectedItem.ToString()

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim selectedDate As Date = DateTimePicker1.Value.Date
            Dim today As Date = Date.Today

            If selectedDate <= Today Then
                MsgBox("Invalid date or you cannot reserve the date today.", MsgBoxStyle.Exclamation)
                Exit Sub
            End If

            sql = $"INSERT INTO vip_reservations (customer_id, room_id,  vip_perk_id , date_reserved, time_reserved, status) VALUES 
('{customerID}', '{roomID}', '{vipPerks}', '{dateReserved}', '{timeReserved}', '{status}')"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery()

            If i > 0 Then
                MsgBox("Record saved.")
                sql = "SELECT vip_reservation_id FROM vip_reservations"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()

                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("vip_reservation_id").ToString())
                End While
                dbread.Close()

            Else
                MsgBox("Record not saved.")
            End If
        Catch ex As MySqlException
            MsgBox("Database error: " & ex.Message)
        Catch ex As Exception
            MsgBox("Unexpected error: " & ex.Message)
        Finally
            conn.Close()
        End Try

    End Sub

    Private Sub Button8_Click(sender As Object, e As EventArgs) Handles Button8.Click
        Dim vipID = Val(ComboBox1.SelectedItem)

        If vipID = 0 Then
            MsgBox("Please select a reservation to cancel.")
            Exit Sub
        End If

        Try
            conn.Open()

            Dim ans = MessageBox.Show("Are you sure you want to cancel this reservation? Only Pending and Prepared orders will be updated.", "Cancel Reservation", MessageBoxButtons.YesNo)
            If ans <> DialogResult.Yes Then Exit Sub

            sql = $"UPDATE vip_reservations SET status = 'Cancelled' WHERE vip_reservation_id = {vipID}"
            dbcomm = New MySqlCommand(sql, conn)
            dbcomm.ExecuteNonQuery()

            sql = $"
            UPDATE vip_food_orderline
            SET status = CASE 
                WHEN status = 'Pending' THEN 'Cancelled'
                WHEN status = 'Prepared' THEN 'Wasted'
                ELSE status
            END
            WHERE vip_reservation_id = {vipID} 
            AND status IN ('Pending', 'Prepared')"

            dbcomm = New MySqlCommand(sql, conn)
            dbcomm.ExecuteNonQuery()

            MsgBox("Reservation successfully canceled. Pending and Prepared food orders updated.")

            ComboBox5.SelectedIndex = -1
            ComboBox1.SelectedIndex = -1
            ComboBox2.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
            ComboBox4.SelectedIndex = -1
            DateTimePicker1.Value = DateTime.Now

        Catch ex As Exception
            MsgBox("Error canceling reservation: " & ex.Message)
        Finally
            conn.Close()
        End Try

        alerts()
    End Sub
End Class










                                        ----------------------------------------------------------------------------
                                                                       DEPARTMENTS
                                        ----------------------------------------------------------------------------











Imports MySql.Data.MySqlClient

Public Class departments
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()
    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim query As String = "SELECT * FROM departments"
            adapter = New MySqlDataAdapter(query, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim deptname = TextBox1.Text
            Dim deptID = ComboBox1.Text.ToString()

            sql = $"SELECT * FROM departments WHERE dept_id = '{deptID}'"

            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "departments")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "departments"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            dbread.Close()
        Catch ex As Exception
            MsgBox("Error in collecting data from Database. Error is :" & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub departments_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM departments"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "departments")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "departments"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox1.Items.Clear()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("dept_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try

    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Dim deptname = TextBox1.Text
        Dim deptID = ComboBox1.Text.ToString()

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"INSERT INTO departments (dept_id, dept_name) VALUES('{deptID}', '{deptname}')"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("Record saved successfully.")
                sql = "SELECT dept_id FROM departments"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()

                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("dept_id").ToString())
                End While
                dbread.Close()

            Else
                MsgBox("Record not saved.")
            End If

        Catch ex As MySqlException
            MsgBox("Department not created. Error: " & ex.Message)
        Finally
            conn.Close()
        End Try

    End Sub

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Dim deptname = TextBox1.Text
        Dim deptID = {Val(ComboBox1.SelectedItem)}
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"UPDATE departments SET dept_name = '{deptname}' WHERE dept_id = {deptID}"

            Label1.Text = sql
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("record updated")
            Else
                MsgBox("record not updated")
            End If


        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        End Try
        conn.Close()

    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim deptID = Val(ComboBox1.SelectedItem)
        Dim deptname = TextBox1.Text
        Dim i As Integer

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim ans = MessageBox.Show("do you want to delete this record?", "record deleted", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM departments WHERE dept_id = {deptID}"
                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("department deleted")
                Else
                    MsgBox("department not deleted")
                End If
            End If
            TextBox1.Clear()
            ComboBox1.SelectedIndex = -1
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)

        End Try
        conn.Close()

    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        TextBox1.Clear()
        ComboBox1.SelectedIndex = -1

    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Dim deptID As String = ComboBox1.Text
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM departments WHERE dept_id = '" & deptID & "'"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            If dbread.Read() Then
                TextBox1.Text = dbread("dept_name").ToString()
            Else
                TextBox1.Clear()
            End If

            dbread.Close()

        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub


    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub
End Class





                                        ----------------------------------------------------------------------------
                                                                           MENU
                                        ----------------------------------------------------------------------------



Imports MySql.Data.MySqlClient
Public Class menu_table
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub menu_table_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM menu"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "menu")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "menu"

            sql = "SELECT menu_id FROM menu ORDER BY menu_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            ComboBox1.Items.Clear()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("menu_id"))
            End While
            dbread.Close()
            conn.Close()
        Catch ex As Exception
            MsgBox("Error loading menu IDs: " & ex.Message)
        End Try

        ComboBox2.Items.Clear()
        ComboBox2.Items.Add("Food")
        ComboBox2.Items.Add("Drinks")
        ComboBox2.SelectedIndex = 0

        ComboBox3.Items.Clear()
        ComboBox3.Items.Add("Available")
        ComboBox3.Items.Add("Not Available")
        ComboBox3.SelectedIndex = 0

    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Dim menuID = Val(ComboBox1.SelectedItem)

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"SELECT * FROM menu WHERE menu_id = {menuID}"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            If dbread.Read() Then
                TextBox1.Text = dbread("name").ToString()
                TextBox3.Text = dbread("flavor").ToString()
                TextBox2.Text = dbread("price").ToString()
                ComboBox2.Text = dbread("category").ToString()
                ComboBox3.Text = dbread("status").ToString()
            End If
            dbread.Close()
            conn.Close()
        Catch ex As Exception
            MsgBox("Error loading menu details: " & ex.Message)
        End Try
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM menu"
            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = table

        Catch ex As Exception
            MsgBox("Error refreshing data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        If ComboBox1.SelectedIndex = -1 Then
            MsgBox("Please select a menu item to search.")
            Exit Sub
        End If

        Dim menuID = ComboBox1.SelectedItem.ToString()

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"SELECT * FROM menu WHERE menu_id = {menuID}"
            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = table
        Catch ex As Exception
            MsgBox("Error collecting data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub


    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Try
            Dim i As Integer = 0
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim name = TextBox1.Text
            Dim flavor = TextBox3.Text
            Dim price = Convert.ToDecimal(TextBox2.Text)
            Dim category = ComboBox2.Text
            Dim status = ComboBox3.Text
            sql = $"INSERT INTO menu (name, flavor, category, price, status) VALUES('{name}', '{flavor}', '{category}', '{price}' , '{status}')"
            dbcomm = New MySqlCommand(sql, conn)
            i = dbcomm.ExecuteNonQuery
            If (i > 0) Then
                MsgBox("food added to menu")
                sql = "SELECT menu_id FROM menu"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()

                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("menu_id").ToString())
                End While
                dbread.Close()

            Else
                MsgBox("food not added to menu")
            End If
        Catch ex As Exception
            MsgBox("Insertion Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Try
            Dim i As Integer = 0
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim menuID = Val(ComboBox1.SelectedItem)
            Dim ans = MessageBox.Show("Do you want to delete this record?", "Confirm Delete", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM menu WHERE menu_id = {menuID}"
                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery
                If (i > 0) Then
                    MsgBox("food deleted")
                Else
                    MsgBox("food not deleted")
                End If
            End If

            TextBox1.Clear()
            TextBox2.Clear()
            TextBox3.Clear()
            ComboBox1.SelectedIndex = -1
            ComboBox2.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1

        Catch ex As Exception
            MsgBox("Delete Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Dim menuID = Val(ComboBox1.Text)
        Dim name = TextBox1.Text
        Dim flavor = TextBox3.Text
        Dim category = ComboBox2.Text
        Dim price = Convert.ToDecimal(TextBox2.Text)
        Dim status = ComboBox3.Text

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"UPDATE menu SET name = '{name}', flavor = '{flavor}', category = '{category}', price = {price}, status = '{status}' WHERE menu_id = {menuID}"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If i > 0 Then
                MsgBox("Menu item updated successfully.")
            Else
                MsgBox("Update failed.")
            End If

        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        TextBox1.Clear()
        TextBox2.Clear()
        TextBox3.Clear()
        ComboBox1.SelectedIndex = -1
        ComboBox2.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub
End Class












                                        ----------------------------------------------------------------------------
                                                                         STAFF ACCOUNTS
                                        ----------------------------------------------------------------------------















Imports MySql.Data.MySqlClient

Public Class staff_accounts
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()
    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim query As String = "SELECT * FROM staff"
            adapter = New MySqlDataAdapter(query, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub


    Private Sub staff_accounts_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM staff"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "staff")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "staff"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("staff_id"))
            End While
            dbread.Close()

            sql = $"SELECT dept_id FROM departments"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox5.Items.Clear()
            While dbread.Read()
                ComboBox5.Items.Add(dbread("dept_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try

        ComboBox2.Items.Clear()
        ComboBox2.Items.Add("Female")
        ComboBox2.Items.Add("Male")
        ComboBox2.SelectedIndex = 0

        ComboBox3.Items.Clear()
        ComboBox3.Items.Add("Chef")
        ComboBox3.Items.Add("Inventory Clerk")
        ComboBox3.Items.Add("Cleaner")
        ComboBox3.Items.Add("System Administrator")
        ComboBox3.Items.Add("Equipment Maintenance Staff")
        ComboBox3.Items.Add("Admin Officer")
        ComboBox3.Items.Add("Front Desk Officer")
        ComboBox3.Items.Add("Equipment Manager")
        ComboBox3.SelectedIndex = 0

        ComboBox4.Items.Clear()
        ComboBox4.Items.Add("Active")
        ComboBox4.Items.Add("On Leave")
        ComboBox4.Items.Add("Resigned")
        ComboBox4.SelectedIndex = 0
    End Sub


    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim staffID = Val(ComboBox1.SelectedItem)

            sql = $"SELECT * FROM staff WHERE staff_id = {staffID}"

            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "staff")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "staff"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            dbread.Close()
        Catch ex As Exception
            MsgBox("Error in collecting data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub


    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Dim firstname = TextBox1.Text
        Dim lastname = TextBox2.Text
        Dim phone_no = TextBox4.Text
        Dim email = TextBox3.Text
        Dim address = TextBox7.Text
        Dim position = ComboBox3.Text
        Dim status = ComboBox4.Text
        Dim sex = ComboBox2.Text
        Dim birthdate = DateTimePicker1.Value.ToString("yyyy-MM-dd")
        Dim date_hired = DateTimePicker2.Value.ToString("yyyy-MM-dd")
        Dim deptID = Val(ComboBox5.Text)
        Dim password = TextBox9.Text

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = $"INSERT INTO staff (dept_id, firstname, lastname, sex, birthdate, address, phone_no, email_add, position, date_hired, 
            status, password) VALUES({deptID}, '{firstname}', '{lastname}', '{sex}', '{birthdate}', '{address}', '{phone_no}', '{email}', 
            '{position}', '{date_hired}', '{status}', '{password}')"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("Record saved successfully.")
                sql = "SELECT staff_id FROM staff"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()

                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("staff_id").ToString())
                End While
                dbread.Close()

            Else
                MsgBox("Record not saved.")
            End If

        Catch ex As MySqlException
            MsgBox("Staff not created. Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Dim staffID = Val(ComboBox1.SelectedItem)
        Dim firstname = TextBox1.Text
        Dim lastname = TextBox2.Text
        Dim phone_no = TextBox4.Text
        Dim email = TextBox3.Text
        Dim address = TextBox7.Text
        Dim position = ComboBox3.SelectedItem
        Dim status = ComboBox4.SelectedItem
        Dim sex = ComboBox2.SelectedItem
        Dim birthdate = DateTimePicker1.Value.ToString("yyyy-MM-dd")
        Dim date_hired = DateTimePicker2.Value.ToString("yyyy-MM-dd")
        Dim deptID = Val(ComboBox5.SelectedItem)
        Dim password = TextBox9.Text

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"UPDATE staff SET dept_id = {deptID}, firstname = '{firstname}', lastname = '{lastname}', sex = '{sex}', birthdate = '{birthdate}', 
           address = '{address}', phone_no = '{phone_no}', email_add = '{email}', position = '{position}', date_hired = '{date_hired}', 
           status = '{status}', password = '{password}' WHERE staff_id = {staffID}"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("Record updated successfully.")
            Else
                MsgBox("No record updated.")
            End If

        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        Finally
            conn.Close()
        End Try

    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim staffID = Val(ComboBox1.SelectedItem)
        Dim i As Integer

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim checkSQL = $"SELECT dept_id FROM staff WHERE staff_id = {staffID}"
            dbcomm = New MySqlCommand(checkSQL, conn)
            dbread = dbcomm.ExecuteReader()
            Dim isAdminToDelete As Boolean = False

            If dbread.Read() Then
                If Convert.ToInt32(dbread("dept_id")) = 1 Then
                    isAdminToDelete = True
                End If
            End If
            dbread.Close()

            If isAdminToDelete Then
                MsgBox("You cannot delete an admin account.")
                conn.Close()
                Exit Sub
            End If

            Dim ans = MessageBox.Show("Do you want to delete this record?", "Confirm Delete", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM staff WHERE staff_id = {staffID}"
                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("Staff deleted.")
                Else
                    MsgBox("Staff not deleted.")
                End If
            End If
            TextBox1.Clear()
            TextBox2.Clear()
            TextBox3.Clear()
            TextBox4.Clear()
            TextBox7.Clear()
            TextBox9.Clear()
            ComboBox1.SelectedIndex = -1
            ComboBox2.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
            ComboBox4.SelectedIndex = -1
            ComboBox5.SelectedIndex = -1
            DateTimePicker1.Value = DateTime.Now
            DateTimePicker2.Value = DateTime.Now

        Catch ex As MySqlException
            MsgBox("MySQL Error: " & ex.Message)
        Catch ex As Exception
            MsgBox("Error: " & ex.Message)
        Finally
            conn.Close()
        End Try

    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        TextBox1.Clear()
        TextBox2.Clear()
        TextBox3.Clear()
        TextBox4.Clear()
        TextBox7.Clear()
        TextBox9.Clear()
        ComboBox1.SelectedIndex = -1
        ComboBox2.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
        ComboBox4.SelectedIndex = -1
        ComboBox5.SelectedIndex = -1
        DateTimePicker1.Value = DateTime.Now
        DateTimePicker2.Value = DateTime.Now

    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        If ComboBox1.SelectedItem Is Nothing OrElse ComboBox1.Text = "" Then
            Exit Sub
        End If
        Dim staffID = Val(ComboBox1.SelectedItem)
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = $"SELECT * FROM staff WHERE staff_id = {staffID}"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            dbread.Read()
            TextBox1.Text = dbread("firstname")
            TextBox2.Text = dbread("lastname")
            TextBox3.Text = dbread("email_add")
            TextBox4.Text = dbread("phone_no")
            TextBox7.Text = dbread("address")
            TextBox9.Text = dbread("password")
            ComboBox2.Text = dbread("sex")
            ComboBox3.Text = dbread("position")
            ComboBox4.Text = dbread("status")
            ComboBox5.Text = dbread("dept_id").ToString()
            DateTimePicker1.Value = Convert.ToDateTime(dbread("birthdate"))
            DateTimePicker2.Value = Convert.ToDateTime(dbread("date_hired"))

            dbread.Close()
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
        conn.Close()
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub
End Class











                                        ----------------------------------------------------------------------------
                                                                 ROOM RESERVATIONS
                                        ----------------------------------------------------------------------------

















Imports MySql.Data.MySqlClient

Public Class room_reservations
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub alerts()
        For Each row As DataGridViewRow In DataGridView1.Rows
            If row.IsNewRow Then Continue For

            Dim status = row.Cells("status").Value

            If status = "Cancelled" Then
                row.DefaultCellStyle.BackColor = Color.Red
                row.DefaultCellStyle.ForeColor = Color.White
            ElseIf status = "No Show" Then
                row.DefaultCellStyle.BackColor = Color.OrangeRed
                row.DefaultCellStyle.ForeColor = Color.White
            ElseIf status = "Booked" Then
                row.DefaultCellStyle.BackColor = Color.Green
                row.DefaultCellStyle.ForeColor = Color.White
            ElseIf status = "Booked" Then
                row.DefaultCellStyle.BackColor = Color.White
                row.DefaultCellStyle.ForeColor = Color.Black
            End If
        Next
    End Sub
    Private Sub room_reservations_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            conn.Open()

            sql = "SELECT * FROM room_reservations"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "room_reservations")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "room_reservations"
            conn.Close()

            conn.Open()
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            ComboBox1.Items.Clear()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("reservation_id"))
            End While
            dbread.Close()

            sql = "SELECT room_id FROM rooms ORDER BY room_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox2.Items.Clear()
            While dbread.Read()
                ComboBox2.Items.Add(dbread("room_id"))
            End While
            dbread.Close()

            sql = "SELECT customer_id FROM customers ORDER BY customer_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox3.Items.Clear()
            While dbread.Read()
                ComboBox3.Items.Add(dbread("customer_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try

        ComboBox4.Items.Clear()
        ComboBox4.Items.Add("Completed")
        ComboBox4.Items.Add("Booked")
        ComboBox4.Items.Add("Cancelled")
        ComboBox4.Items.Add("No Show")
        ComboBox4.SelectedIndex = 0

        alerts()
    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Dim reserveID As String = ComboBox1.Text
        Try
            conn.Open()
            sql = "SELECT * FROM room_reservations WHERE reservation_id = " & reserveID

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            If dbread.Read() Then
                ComboBox5.Text = dbread("time_reserved")
                ComboBox2.Text = dbread("room_id")
                ComboBox3.Text = dbread("customer_id")
                ComboBox4.Text = dbread("status")
                DateTimePicker1.Value = Convert.ToDateTime(dbread("date_reserved"))
            End If
            dbread.Close()

        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)

        End Try
        conn.Close()
        alerts()
    End Sub


    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            conn.Open()
            Dim query As String = "SELECT * FROM room_reservations"
            adapter = New MySqlDataAdapter(query, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            conn.Open()

            Dim reservationID = Val(ComboBox1.SelectedItem)
            Dim roomID = Val(ComboBox2.SelectedItem)
            Dim customerID = Val(ComboBox3.SelectedItem)
            Dim dateReserved = DateTimePicker1.Value.ToString("yyyy-MM-dd")
            Dim timeReserved = ComboBox5.SelectedItem
            Dim status = ComboBox4.SelectedItem.ToString()

            sql = $"SELECT * FROM room_reservations WHERE reservation_id = {reservationID}"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "room_reservations")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "room_reservations"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            ComboBox1.Items.Clear()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("reservation_id"))
            End While

            dbread.Close()
        Catch ex As Exception
            MsgBox("Error in collecting data from Database. Error is :" & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Try
            conn.Open()

            Dim reservationID = Val(ComboBox1.SelectedItem)
            Dim roomID = Val(ComboBox2.SelectedItem)
            Dim customerID = Val(ComboBox3.SelectedItem)
            Dim dateReserved = DateTimePicker1.Value.ToString("yyyy-MM-dd")
            Dim timeReserved = ComboBox5.SelectedItem
            Dim status = ComboBox4.SelectedItem.ToString()

            sql = $"UPDATE room_reservations SET room_id = '{roomID}', customer_id = '{customerID}', date_reserved = '{dateReserved}', 
time_reserved = '{timeReserved}', status = '{status}' WHERE reservation_id = {reservationID}"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("record updated")
            Else
                MsgBox("record not updated")

            End If

        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        End Try
        conn.Close()
        alerts()
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim reservationID = Val(ComboBox1.SelectedItem)
        Dim i As Integer
        Try
            conn.Open()

            Dim ans = MessageBox.Show("do you want to delete this record?", "record deleted", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM room_reservations WHERE reservation_id = {reservationID}"
                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("room_reservation deleted")
                Else
                    MsgBox("room_reservation not deleted")
                End If
            End If
            ComboBox5.SelectedIndex = -1
            ComboBox1.SelectedIndex = -1
            ComboBox2.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
            ComboBox4.SelectedIndex = -1
            DateTimePicker1.Value = DateTime.Now
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)

        End Try
        conn.Close()
        alerts()
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        ComboBox5.SelectedIndex = -1
        ComboBox1.SelectedIndex = -1
        ComboBox2.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
        ComboBox4.SelectedIndex = -1
        DateTimePicker1.Value = DateTime.Now
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Dim reservationID As Integer = Val(ComboBox1.SelectedItem)

        If reservationID = 0 Then
            MsgBox("Please select a reservation to cancel.")
            Exit Sub
        End If

        Try
            conn.Open()

            Dim ans = MessageBox.Show("Are you sure you want to cancel this reservation? Only Pending and Prepared orders will be updated.", "Cancel Reservation", MessageBoxButtons.YesNo)
            If ans <> DialogResult.Yes Then Exit Sub

            sql = $"UPDATE room_reservations SET status = 'Cancelled' WHERE reservation_id = {reservationID}"
            dbcomm = New MySqlCommand(sql, conn)
            dbcomm.ExecuteNonQuery()

            sql = $"
            UPDATE food_orderline 
            SET status = CASE 
                WHEN status = 'Pending' THEN 'Cancelled'
                WHEN status = 'Prepared' THEN 'Wasted'
                ELSE status
            END
            WHERE reservation_id = {reservationID} 
            AND status IN ('Pending', 'Prepared')"
            dbcomm = New MySqlCommand(sql, conn)
            dbcomm.ExecuteNonQuery()

            MsgBox("Reservation successfully canceled. Pending and Prepared food orders updated.")

            ComboBox5.SelectedIndex = -1
            ComboBox1.SelectedIndex = -1
            ComboBox2.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
            ComboBox4.SelectedIndex = -1
            DateTimePicker1.Value = DateTime.Now

        Catch ex As Exception
            MsgBox("Error canceling reservation: " & ex.Message)
        Finally
            conn.Close()
        End Try

        alerts()
    End Sub


    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub

    Private Sub Button8_Click(sender As Object, e As EventArgs) Handles Button8.Click
        Dim roomID = Val(ComboBox2.SelectedItem)
        Dim customerID = Val(ComboBox3.SelectedItem)
        Dim dateReserved = DateTimePicker1.Value.ToString("yyyy-MM-dd")
        Dim timeReserved = ComboBox5.SelectedItem.ToString()
        Dim status = ComboBox4.SelectedItem.ToString()

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim selectedDate As Date = DateTimePicker1.Value.Date
            Dim today As Date = Date.Today

            If selectedDate <= today Then
                MsgBox("Invalid date or you cannot reserve the date today.", MsgBoxStyle.Exclamation)
                Exit Sub
            End If

            sql = $"INSERT INTO room_reservations (customer_id, room_id, date_reserved, time_reserved, status) VALUES 
('{customerID}', '{roomID}', '{dateReserved}', '{timeReserved}', '{status}')"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery()

            If i > 0 Then
                MsgBox("Record saved.")
                sql = "SELECT reservation_id FROM room_reservations"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()

                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("reservation_id").ToString())
                End While
                dbread.Close()

            Else
                MsgBox("Record not saved.")
            End If

        Catch ex As MySqlException
            MsgBox("Database error: " & ex.Message)
        Catch ex As Exception
            MsgBox("Unexpected error: " & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub


    Private Sub ComboBox2_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox2.SelectedIndexChanged
        Dim roomID = Val(ComboBox2.SelectedItem)

        ComboBox5.Items.Clear()
        If roomID = 1 Then
            ComboBox5.Items.AddRange(New String() {
            "1:00 PM - 3:00 PM",
            "4:00 PM - 6:00 PM",
            "7:00 PM - 9:00 PM",
            "10:00 PM - 12:00 MN",
            "1:00 AM - 3:00 AM"
        })
        Else
            ComboBox5.Items.AddRange(New String() {
            "1:00 PM - 5:00 PM",
            "6:00 PM - 10:00 PM",
            "11:00 PM - 3:00 AM"
        })
        End If
        ComboBox5.SelectedIndex = 0
    End Sub
End Class









                                        ----------------------------------------------------------------------------
                                                                             FOOD ORDERS
                                        ----------------------------------------------------------------------------












Imports MySql.Data.MySqlClient

Public Class food_orders
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub alerts()
        For Each row As DataGridViewRow In DataGridView1.Rows
            If row.IsNewRow Then Continue For

            Dim status = row.Cells("status").Value

            If status = "Prepared" Then
                row.DefaultCellStyle.BackColor = Color.Green
                row.DefaultCellStyle.ForeColor = Color.White
            ElseIf status = "Completed" Then
                row.DefaultCellStyle.BackColor = Color.White
                row.DefaultCellStyle.ForeColor = Color.Black
            ElseIf status = "Pending" Then
                row.DefaultCellStyle.BackColor = Color.Yellow
                row.DefaultCellStyle.ForeColor = Color.Black
            ElseIf status = "Cancelled" Then
                row.DefaultCellStyle.BackColor = Color.Red
                row.DefaultCellStyle.ForeColor = Color.White
            ElseIf status = "Wasted" Then
                row.DefaultCellStyle.BackColor = Color.Brown
                row.DefaultCellStyle.ForeColor = Color.White
            End If
        Next
    End Sub

    Private Sub food_orders_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT 
                  fo.order_id,
                  fo.reservation_id,
                  CONCAT(c.firstname, ' ', c.lastname) AS customer_name,
                  fo.menu_id,
                  m.name AS menu_name,
                  fo.quantity,
                  fo.status,
                  fo.details
               FROM food_orderline fo
               INNER JOIN room_reservations rr ON fo.reservation_id = rr.reservation_id
               INNER JOIN customers c ON rr.customer_id = c.customer_id
               INNER JOIN menu m ON fo.menu_id = m.menu_id"

            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            table.Clear()
            DataAdapter1.Fill(table)
            DataGridView1.DataSource = table
            DataGridView1.AutoGenerateColumns = True

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox1.Items.Clear()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("order_id"))
            End While
            dbread.Close()

            sql = "SELECT menu_id FROM menu ORDER BY menu_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox3.Items.Clear()
            While dbread.Read()
                ComboBox3.Items.Add(dbread("menu_id"))
            End While
            dbread.Close()

            sql = "SELECT reservation_id FROM room_reservations ORDER BY reservation_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox4.Items.Clear()
            While dbread.Read()
                ComboBox4.Items.Add(dbread("reservation_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try

        ComboBox5.Items.Clear()
        ComboBox5.Items.Add("Pending")
        ComboBox5.Items.Add("Prepared")
        ComboBox5.Items.Add("Completed")
        ComboBox5.Items.Add("Cancelled")
        ComboBox5.Items.Add("Wasted")
        ComboBox5.SelectedIndex = 0

        alerts()
    End Sub


    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged

        If ComboBox1.SelectedItem Is Nothing OrElse ComboBox1.Text = "" Then
            Exit Sub
        End If

        Dim orderID As String = ComboBox1.Text
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM food_orderline WHERE order_id = " & orderID
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            If dbread.Read() Then
                TextBox1.Text = dbread("quantity").ToString()
                ComboBox3.Text = dbread("menu_id").ToString()
                ComboBox4.Text = dbread("reservation_id").ToString()
                ComboBox5.Text = dbread("status").ToString()
                TextBox2.Text = dbread("details").ToString()
            End If

            dbread.Close()

        Catch ex As MySqlException
            MsgBox("Database error: " & ex.Message)
        Catch ex As Exception
            MsgBox("Unexpected error: " & ex.Message)
        Finally
            conn.Close()
        End Try

        alerts()
    End Sub


    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            conn.Open()
            sql = "SELECT 
                    fo.order_id,
                    fo.reservation_id,
                    CONCAT(c.firstname, ' ', c.lastname) AS customer_name,
                    fo.menu_id,
                     m.name AS menu_name,
                     fo.quantity,
                    fo.status,
                    fo.details
                  FROM food_orderline fo
                INNER JOIN room_reservations rr ON fo.reservation_id = rr.reservation_id
            INNER JOIN customers c ON rr.customer_id = c.customer_id
            INNER JOIN menu m ON fo.menu_id = m.menu_id"
            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            conn.Open()

            Dim orderID = Val(ComboBox1.SelectedItem)
            Dim menuID = Val(ComboBox3.SelectedItem)
            Dim quantity = TextBox1.Text
            Dim reservationID = Val(ComboBox4.SelectedItem)
            Dim status = ComboBox5.SelectedItem

            sql = "SELECT 
                    fo.order_id,
                    fo.reservation_id,
                    CONCAT(c.firstname, ' ', c.lastname) AS customer_name,
                    fo.menu_id,
                     m.name AS menu_name,
                     fo.quantity,
                    fo.status,
                    fo.details
                  FROM food_orderline fo
                INNER JOIN room_reservations rr ON fo.reservation_id = rr.reservation_id
            INNER JOIN customers c ON rr.customer_id = c.customer_id
            INNER JOIN menu m ON fo.menu_id = m.menu_id
                WHERE fo.order_id = " & orderID

            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "food_orderline")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "food_orderline"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            While dbread.Read()
                ComboBox1.Items.Add(dbread("order_id"))
            End While

            dbread.Close()
        Catch ex As Exception
            MsgBox("Error in collecting data from Database. Error is :" & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Dim details = TextBox2.Text
        Dim menuID = Val(ComboBox3.SelectedItem)
        Dim quantity = TextBox1.Text
        Dim reservationID = Val(ComboBox4.SelectedItem)
        Dim status = ComboBox5.SelectedItem
        If details = "" Then details = "N/A"


        Try
            conn.Open()
            sql = $"INSERT INTO food_orderline (reservation_id, menu_id, quantity, status, details) 
VALUES( {reservationID}, {menuID}, {quantity},'{status}', '{details}')"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("Record saved successfully.")
                sql = "SELECT order_id FROM food_orderline"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()

                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("order_id").ToString())
                End While
                dbread.Close()
            Else
                MsgBox("Record Not saved.")
            End If

        Catch ex As MySqlException
            MsgBox("food order Not created. Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click

        Dim orderID = Val(ComboBox1.SelectedItem)
        Dim menuID = Val(ComboBox3.SelectedItem)
        Dim quantity = TextBox1.Text
        Dim reservationID = Val(ComboBox4.SelectedItem)
        Dim status = ComboBox5.SelectedItem
        Dim details = TextBox2.Text
        If details = "" Then details = "N/A"


        Try
            conn.Open()

            sql = $"UPDATE food_orderline SET reservation_id = {reservationID}, menu_id = {menuID}, quantity = {quantity}, status = '{status}', 
                   details = '{details}' WHERE order_id = {orderID}"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery()

            If i > 0 Then
                MsgBox("Record updated successfully.")
            Else
                MsgBox("No record was updated. Please check the Order ID.")
            End If

        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        Finally
            conn.Close()
        End Try
        conn.Close()
        alerts()
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim orderID = Val(ComboBox1.SelectedItem)
        Dim i As Integer
        Try
            conn.Open()

            Dim ans = MessageBox.Show("do you want to delete this record?", "record deleted", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM food_orderline WHERE order_id = {orderID}"
                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("customer deleted")
                Else
                    MsgBox("customer not deleted")
                End If
            End If
            TextBox1.Clear()
            ComboBox1.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
            ComboBox4.SelectedIndex = -1
            ComboBox5.SelectedIndex = -1
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)

        End Try
        conn.Close()
        alerts()
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Dim orderID = Val(ComboBox1.SelectedItem)
        Dim reservationID = Val(ComboBox4.SelectedItem)

        Try
            conn.Open()

            sql = $"SELECT COUNT(*) FROM food_orderline WHERE reservation_id = {reservationID}"
            dbcomm = New MySqlCommand(sql, conn)
            Dim count = Convert.ToInt32(dbcomm.ExecuteScalar())
            If count = 0 Then
                MsgBox("No items found for this reservation.")
                Exit Sub
            End If

            Dim ans = MessageBox.Show("Are you sure you want to cancel this order?", "Cancel Order", MessageBoxButtons.YesNo)
            If ans <> DialogResult.Yes Then Exit Sub

            Dim status As String = If(ComboBox5.Text = "Prepared", "Wasted", "Cancelled")

            sql = $"UPDATE food_orderline SET status = '{status}' "

            If orderID > 0 And reservationID > 0 Then
                sql &= $"WHERE order_id = {orderID} AND reservation_id = {reservationID}"
            ElseIf orderID > 0 Then
                sql &= $"WHERE order_id = {orderID}"
            ElseIf reservationID > 0 Then
                sql &= $"WHERE reservation_id = {reservationID}"
            Else
                MsgBox("Please select at least one filter before canceling.")
                Exit Sub
            End If

            dbcomm = New MySqlCommand(sql, conn)
            Dim result = dbcomm.ExecuteNonQuery()

            If result > 0 Then
                MsgBox("Order successfully canceled.")
                ComboBox5.Text = status
            Else
                MsgBox("Order could not be canceled.")
            End If

        Catch ex As Exception
            MsgBox("Error canceling order: " & ex.Message)
        Finally
            conn.Close()
        End Try

        alerts()
    End Sub



    Private Sub Button8_Click(sender As Object, e As EventArgs) Handles Button8.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        TextBox1.Clear()
        TextBox2.Clear()
        ComboBox1.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
        ComboBox4.SelectedIndex = -1
        ComboBox5.SelectedIndex = -1

    End Sub
End Class








                                        ----------------------------------------------------------------------------
                                                     CUSTOMER PAYMENTS
                                        ----------------------------------------------------------------------------














Imports MySql.Data.MySqlClient

Public Class customer_payments
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()
    Private Sub customer_payments_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            conn.Open()

            sql = $"SELECT * FROM customer_payments"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "customer_payments")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "customer_payments"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox1.Items.Clear()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("payment_id"))
            End While
            dbread.Close()

            sql = "SELECT customer_id FROM customers"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox2.Items.Clear()
            While dbread.Read()
                ComboBox2.Items.Add(dbread("customer_id").ToString())
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
        ComboBox3.Items.Clear()
        ComboBox3.Items.Add("Reservation")
        ComboBox3.Items.Add("Order")
        ComboBox3.Items.Add("VIP")
        ComboBox3.Items.Add("Cancellation Fee")
        ComboBox3.SelectedIndex = 0
    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        If ComboBox1.SelectedItem Is Nothing OrElse ComboBox1.Text = "" Then
            Exit Sub
        End If
        Dim payID As String = ComboBox1.Text
        Try
            conn.Open()
            sql = "SELECT * FROM customer_payments WHERE payment_id = " & payID

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            If dbread.Read() Then

                TextBox1.Text = dbread("amount_paid")
                ComboBox2.Text = dbread("customer_id")
                ComboBox3.Text = dbread("action")
            End If
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)

        End Try
        conn.Close()
    End Sub


    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            conn.Open()
            Dim query As String = "SELECT * FROM customer_payments"
            adapter = New MySqlDataAdapter(query, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            conn.Open()

            Dim payID = ComboBox1.SelectedItem.ToString()

            sql = $"SELECT * FROM customer_payments WHERE payment_id = {payID}"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "customer_payments")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "customer_payments"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            ComboBox1.Items.Clear()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("payment_id"))
            End While

            dbread.Close()
        Catch ex As Exception
            MsgBox("Error in collecting data from Database. Error is :" & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Dim amountPaid = Convert.ToDecimal(TextBox1.Text)
        Dim customerID = ComboBox2.SelectedItem.ToString()
        Dim action = ComboBox3.SelectedItem.ToString()

        Try
            conn.Open()
            sql = $"INSERT INTO customer_payments (customer_id, action, amount_paid, timestamp) VALUES( 
            '{customerID}', '{action}', '{amountPaid}',  NOW())"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("Record saved successfully.")
                sql = "SELECT payment_id FROM customer_payments"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()

                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("payment_id").ToString())
                End While
                dbread.Close()

            Else
                MsgBox("Record not saved.")
            End If

        Catch ex As MySqlException
            MsgBox("record not added. Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim amountPaid = TextBox1.Text
        Dim payID = ComboBox1.SelectedItem.ToString()
        Dim customerID = ComboBox2.SelectedItem.ToString()
        Dim action = ComboBox3.SelectedItem.ToString()
        Try
            conn.Open()

            sql = $"UPDATE customer_payments SET customer_id = '{customerID}', action = '{action}', amount_paid = '{amountPaid}', 
timestamp = NOW() WHERE payment_id = {payID}"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("record updated")
            Else
                MsgBox("record not updated")

            End If

        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        End Try
        conn.Close()
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        TextBox1.Clear()
        ComboBox1.SelectedIndex = -1
        ComboBox2.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
    End Sub
End Class







                                        ----------------------------------------------------------------------------
                                                             ROOMS HAS EQUIPMENTS
                                        ----------------------------------------------------------------------------











Imports System.Windows.Forms.VisualStyles.VisualStyleElement
Imports MySql.Data.MySqlClient

Public Class rooms_has_equipments
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub rooms_has_equipments_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT r.room_id, r.room_no AS room_number, r.room_type, e.equipment_id, e.name AS equipment_name " &
      "FROM rooms_has_equipments rhe " &
      "JOIN rooms r ON rhe.room_id = r.room_id " &
      "JOIN equipment_inventory e ON rhe.equipment_id = e.equipment_id "

            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = table

            sql = "SELECT room_id FROM rooms"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox3.Items.Clear()
            While dbread.Read()
                ComboBox3.Items.Add(dbread("room_id"))
            End While
            dbread.Close()

            sql = "SELECT equipment_id FROM equipment_inventory ORDER BY equipment_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox1.Items.Clear()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("equipment_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Dim roomID = Val(ComboBox3.SelectedItem)
        Dim equipID = Val(ComboBox1.SelectedItem)

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT r.room_id, r.room_no AS room_number, r.room_type, e.equipment_id, e.name AS equipment_name " &
      "FROM rooms_has_equipments rhe " &
      "JOIN rooms r ON rhe.room_id = r.room_id " &
      "JOIN equipment_inventory e ON rhe.equipment_id = e.equipment_id "


            If roomID > 0 And equipID > 0 Then
                sql &= $"WHERE rhe.room_id = {roomID} AND rhe.equipment_id = {equipID}"
            ElseIf roomID > 0 Then
                sql &= $"WHERE rhe.room_id = {roomID}"
            ElseIf equipID > 0 Then
                sql &= $"WHERE rhe.equipment_id = {equipID}"
            End If

            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = table

        Catch ex As Exception
            MsgBox("Error filtering data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Dim roomID = Val(ComboBox3.SelectedItem)
        Dim equipID = Val(ComboBox1.SelectedItem)

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"INSERT INTO rooms_has_equipments (room_id, equipment_id) VALUES({roomID}, {equipID})"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If i > 0 Then
                MsgBox("Record inserted successfully.")
            Else
                MsgBox("Insert failed.")
            End If

            ComboBox1.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
        Catch ex As Exception
            MsgBox("Error inserting record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Dim roomID = Val(ComboBox3.SelectedItem)
        Dim equipID = Val(ComboBox1.SelectedItem)

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"UPDATE rooms_has_equipments SET equipment_id = {equipID} WHERE room_id = {roomID}"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If i > 0 Then
                MsgBox("Record updated.")
            Else
                MsgBox("Update failed.")
            End If
        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim roomID = Val(ComboBox3.SelectedItem)
        Dim equipID = Val(ComboBox1.SelectedItem)

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim ans = MessageBox.Show("Do you want to delete this record?", "Delete Record", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM rooms_has_equipments "

                If roomID > 0 And equipID > 0 Then
                    sql &= $"WHERE room_id = {roomID} AND equipment_id = {equipID}"
                ElseIf roomID > 0 Then
                    sql &= $"WHERE room_id = {roomID}"
                ElseIf equipID > 0 Then
                    sql &= $"WHERE equipment_id = {equipID}"
                ElseIf roomID = 0 And equipID = 0 Then
                    MsgBox("Please select at least one filter before deleting.")
                End If

                dbcomm = New MySqlCommand(sql, conn)
                Dim i As Integer = dbcomm.ExecuteNonQuery
            End If

            ComboBox1.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
        Catch ex As Exception
            MsgBox("Error deleting record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        ComboBox1.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
    End Sub

    Private Sub Button8_Click(sender As Object, e As EventArgs) Handles Button8.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = "SELECT r.room_id, r.room_no AS room_number, r.room_type, e.equipment_id, e.name AS equipment_name " &
      "FROM rooms_has_equipments rhe " &
      "JOIN rooms r ON rhe.room_id = r.room_id " &
      "JOIN equipment_inventory e ON rhe.equipment_id = e.equipment_id "
            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub
End Class














                                        ----------------------------------------------------------------------------
                                                               	menu has ingredients
                                        ----------------------------------------------------------------------------











Imports MySql.Data.MySqlClient

Public Class food_has_ingredients
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub food_has_ingredients_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT m.menu_id, m.name AS food_name, m.flavor, f.food_id, f.name AS ingredient_name " &
                  "FROM menu_has_ingredients mh " &
                  "JOIN menu m ON mh.menu_id = m.menu_id " &
                  "JOIN food_inventory f ON mh.food_id = f.food_id"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            table.Clear()
            DataAdapter1.Fill(table)
            DataGridView1.DataSource = table
            DataGridView1.AutoGenerateColumns = True

            sql = "SELECT menu_id FROM menu"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox1.Items.Clear()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("menu_id"))
            End While
            dbread.Close()

            sql = "SELECT food_id FROM food_inventory ORDER BY food_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox3.Items.Clear()
            While dbread.Read()
                ComboBox3.Items.Add(dbread("food_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Dim menuID = Val(ComboBox1.SelectedItem)
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = "SELECT * FROM menu WHERE menu_id = " & menuID
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            dbread.Read()
        Catch ex As Exception
            MsgBox("Error loading menu details: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            sql = "SELECT m.menu_id, m.name AS food_name, m.flavor, f.food_id, f.name AS ingredient_name " &
              "FROM menu_has_ingredients mh " &
              "JOIN menu m ON mh.menu_id = m.menu_id " &
              "JOIN food_inventory f ON mh.food_id = f.food_id "
            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Dim menuID = Val(ComboBox1.SelectedItem)
        Dim foodID = Val(ComboBox3.SelectedItem)

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT m.menu_id, m.name AS food_name, m.flavor, f.food_id, f.name AS ingredient_name " &
              "FROM menu_has_ingredients mh " &
              "JOIN menu m ON mh.menu_id = m.menu_id " &
              "JOIN food_inventory f ON mh.food_id = f.food_id "

            If menuID > 0 And foodID > 0 Then
                sql &= $"WHERE mh.menu_id = {menuID} AND mh.food_id = {foodID}"
            ElseIf menuID > 0 Then
                sql &= $"WHERE mh.menu_id = {menuID}"
            ElseIf foodID > 0 Then
                sql &= $"WHERE mh.food_id = {foodID}"
            End If

            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = table

        Catch ex As Exception
            MsgBox("Error filtering data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub


    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Dim menuID = Val(ComboBox1.SelectedItem)
        Dim foodID = Val(ComboBox3.SelectedItem)

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"INSERT INTO menu_has_ingredients (menu_id, food_id) VALUES({menuID}, {foodID})"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If i > 0 Then
                MsgBox("Record saved successfully.")
            Else
                MsgBox("Record not saved.")
            End If

            ComboBox1.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
        Catch ex As Exception
            MsgBox("Error inserting record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Dim menuID = Val(ComboBox1.SelectedItem)
        Dim foodID = Val(ComboBox3.SelectedItem)

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"UPDATE menu_has_ingredients SET food_id = {foodID} WHERE menu_id = {menuID}"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If i > 0 Then
                MsgBox("Record updated.")
            Else
                MsgBox("Record not updated.")
            End If
        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim menuID = Val(ComboBox1.SelectedItem)
        Dim foodID = Val(ComboBox3.SelectedItem)

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim ans = MessageBox.Show("Do you want to delete this record?", "Delete Record", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM menu_has_ingredients "

                If menuID > 0 And foodID > 0 Then
                    sql &= $"WHERE menu_id = {menuID} AND food_id = {foodID}"
                ElseIf menuID > 0 Then
                    sql &= $"WHERE menu_id = {menuID}"
                ElseIf foodID > 0 Then
                    sql &= $"WHERE food_id = {foodID}"
                ElseIf menuID = 0 And foodID = 0 Then
                    MsgBox("Please select at least one filter before deleting.")
                End If

                dbcomm = New MySqlCommand(sql, conn)
                Dim i As Integer = dbcomm.ExecuteNonQuery

                If i > 0 Then
                    MsgBox("Record deleted.")
                Else
                    MsgBox("Record not deleted.")
                End If
            End If

            ComboBox1.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
        Catch ex As Exception
            MsgBox("Error deleting record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        ComboBox1.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
    End Sub

    Private Sub Button8_Click(sender As Object, e As EventArgs) Handles Button8.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub
End Class














                                        ----------------------------------------------------------------------------
                                                                 FOOD ORDERLINE
                                        ----------------------------------------------------------------------------













Imports MySql.Data.MySqlClient

Public Class food_orders
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub alerts()
        For Each row As DataGridViewRow In DataGridView1.Rows
            If row.IsNewRow Then Continue For

            Dim status = row.Cells("status").Value

            If status = "Prepared" Then
                row.DefaultCellStyle.BackColor = Color.Green
                row.DefaultCellStyle.ForeColor = Color.White
            ElseIf status = "Completed" Then
                row.DefaultCellStyle.BackColor = Color.White
                row.DefaultCellStyle.ForeColor = Color.Black
            ElseIf status = "Pending" Then
                row.DefaultCellStyle.BackColor = Color.Yellow
                row.DefaultCellStyle.ForeColor = Color.Black
            ElseIf status = "Cancelled" Then
                row.DefaultCellStyle.BackColor = Color.Red
                row.DefaultCellStyle.ForeColor = Color.White
            ElseIf status = "Wasted" Then
                row.DefaultCellStyle.BackColor = Color.Brown
                row.DefaultCellStyle.ForeColor = Color.White
            End If
        Next
    End Sub

    Private Sub food_orders_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT 
                  fo.order_id,
                  fo.reservation_id,
                  CONCAT(c.firstname, ' ', c.lastname) AS customer_name,
                  fo.menu_id,
                  m.name AS menu_name,
                  fo.quantity,
                  fo.status,
                  fo.details
               FROM food_orderline fo
               INNER JOIN room_reservations rr ON fo.reservation_id = rr.reservation_id
               INNER JOIN customers c ON rr.customer_id = c.customer_id
               INNER JOIN menu m ON fo.menu_id = m.menu_id"

            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            table.Clear()
            DataAdapter1.Fill(table)
            DataGridView1.DataSource = table
            DataGridView1.AutoGenerateColumns = True

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox1.Items.Clear()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("order_id"))
            End While
            dbread.Close()

            sql = "SELECT menu_id FROM menu ORDER BY menu_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox3.Items.Clear()
            While dbread.Read()
                ComboBox3.Items.Add(dbread("menu_id"))
            End While
            dbread.Close()

            sql = "SELECT reservation_id FROM room_reservations ORDER BY reservation_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox4.Items.Clear()
            While dbread.Read()
                ComboBox4.Items.Add(dbread("reservation_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try

        ComboBox5.Items.Clear()
        ComboBox5.Items.Add("Pending")
        ComboBox5.Items.Add("Prepared")
        ComboBox5.Items.Add("Completed")
        ComboBox5.Items.Add("Cancelled")
        ComboBox5.Items.Add("Wasted")
        ComboBox5.SelectedIndex = 0

        alerts()
    End Sub


    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged

        If ComboBox1.SelectedItem Is Nothing OrElse ComboBox1.Text = "" Then
            Exit Sub
        End If

        Dim orderID As String = ComboBox1.Text
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM food_orderline WHERE order_id = " & orderID
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            If dbread.Read() Then
                TextBox1.Text = dbread("quantity").ToString()
                ComboBox3.Text = dbread("menu_id").ToString()
                ComboBox4.Text = dbread("reservation_id").ToString()
                ComboBox5.Text = dbread("status").ToString()
                TextBox2.Text = dbread("details").ToString()
            End If

            dbread.Close()

        Catch ex As MySqlException
            MsgBox("Database error: " & ex.Message)
        Catch ex As Exception
            MsgBox("Unexpected error: " & ex.Message)
        Finally
            conn.Close()
        End Try

        alerts()
    End Sub


    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            conn.Open()
            sql = "SELECT 
                    fo.order_id,
                    fo.reservation_id,
                    CONCAT(c.firstname, ' ', c.lastname) AS customer_name,
                    fo.menu_id,
                     m.name AS menu_name,
                     fo.quantity,
                    fo.status,
                    fo.details
                  FROM food_orderline fo
                INNER JOIN room_reservations rr ON fo.reservation_id = rr.reservation_id
            INNER JOIN customers c ON rr.customer_id = c.customer_id
            INNER JOIN menu m ON fo.menu_id = m.menu_id"
            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            conn.Open()

            Dim orderID = Val(ComboBox1.SelectedItem)
            Dim menuID = Val(ComboBox3.SelectedItem)
            Dim quantity = TextBox1.Text
            Dim reservationID = Val(ComboBox4.SelectedItem)
            Dim status = ComboBox5.SelectedItem

            sql = "SELECT 
                    fo.order_id,
                    fo.reservation_id,
                    CONCAT(c.firstname, ' ', c.lastname) AS customer_name,
                    fo.menu_id,
                     m.name AS menu_name,
                     fo.quantity,
                    fo.status,
                    fo.details
                  FROM food_orderline fo
                INNER JOIN room_reservations rr ON fo.reservation_id = rr.reservation_id
            INNER JOIN customers c ON rr.customer_id = c.customer_id
            INNER JOIN menu m ON fo.menu_id = m.menu_id
                WHERE order_id = " & orderID

            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "food_orderline")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "food_orderline"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            While dbread.Read()
                ComboBox1.Items.Add(dbread("order_id"))
            End While

            dbread.Close()
        Catch ex As Exception
            MsgBox("Error in collecting data from Database. Error is :" & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Dim details = TextBox2.Text
        Dim menuID = Val(ComboBox3.SelectedItem)
        Dim quantity = TextBox1.Text
        Dim reservationID = Val(ComboBox4.SelectedItem)
        Dim status = ComboBox5.SelectedItem
        If details = "" Then details = "N/A"


        Try
            conn.Open()
            sql = $"INSERT INTO food_orderline (reservation_id, menu_id, quantity, status, details) 
VALUES( {reservationID}, {menuID}, {quantity},'{status}', '{details}')"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("Record saved successfully.")
            Else
                MsgBox("Record Not saved.")
            End If

        Catch ex As MySqlException
            MsgBox("food order Not created. Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
        alerts()
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click

        Dim orderID = Val(ComboBox1.SelectedItem)
        Dim menuID = Val(ComboBox3.SelectedItem)
        Dim quantity = TextBox1.Text
        Dim reservationID = Val(ComboBox4.SelectedItem)
        Dim status = ComboBox5.SelectedItem
        Dim details = TextBox2.Text
        If details = "" Then details = "N/A"


        Try
            conn.Open()

            sql = $"UPDATE food_orderline SET reservation_id = {reservationID}, menu_id = {menuID}, quantity = {quantity}, status = '{status}', 
                   details = '{details}' WHERE order_id = {orderID}"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery()

            If i > 0 Then
                MsgBox("Record updated successfully.")
            Else
                MsgBox("No record was updated. Please check the Order ID.")
            End If

        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        Finally
            conn.Close()
        End Try
        conn.Close()
        alerts()
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim orderID = Val(ComboBox1.SelectedItem)
        Dim i As Integer
        Try
            conn.Open()

            Dim ans = MessageBox.Show("do you want to delete this record?", "record deleted", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM food_orderline WHERE order_id = {orderID}"
                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("customer deleted")
                Else
                    MsgBox("customer not deleted")
                End If
            End If
            TextBox1.Clear()
            ComboBox1.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
            ComboBox4.SelectedIndex = -1
            ComboBox5.SelectedIndex = -1
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)

        End Try
        conn.Close()
        alerts()
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Dim orderID = Val(ComboBox1.SelectedItem)
        Dim reservationID = Val(ComboBox4.SelectedItem)

        Try
            conn.Open()

            sql = $"SELECT COUNT(*) FROM food_orderline WHERE reservation_id = {reservationID}"
            dbcomm = New MySqlCommand(sql, conn)
            Dim count = Convert.ToInt32(dbcomm.ExecuteScalar())
            If count = 0 Then
                MsgBox("No items found for this reservation.")
                Exit Sub
            End If

            Dim ans = MessageBox.Show("Are you sure you want to cancel this order?", "Cancel Order", MessageBoxButtons.YesNo)
            If ans <> DialogResult.Yes Then Exit Sub

            Dim status As String = If(ComboBox5.Text = "Prepared", "Wasted", "Cancelled")

            sql = $"UPDATE food_orderline SET status = '{status}' "

            If orderID > 0 And reservationID > 0 Then
                sql &= $"WHERE order_id = {orderID} AND reservation_id = {reservationID}"
            ElseIf orderID > 0 Then
                sql &= $"WHERE order_id = {orderID}"
            ElseIf reservationID > 0 Then
                sql &= $"WHERE reservation_id = {reservationID}"
            Else
                MsgBox("Please select at least one filter before canceling.")
                Exit Sub
            End If

            dbcomm = New MySqlCommand(sql, conn)
            Dim result = dbcomm.ExecuteNonQuery()

            If result > 0 Then
                MsgBox("Order successfully canceled.")
                ComboBox5.Text = status
            Else
                MsgBox("Order could not be canceled.")
            End If

        Catch ex As Exception
            MsgBox("Error canceling order: " & ex.Message)
        Finally
            conn.Close()
        End Try

        alerts()
    End Sub



    Private Sub Button8_Click(sender As Object, e As EventArgs) Handles Button8.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        TextBox1.Clear()
        TextBox2.Clear()
        ComboBox1.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
        ComboBox4.SelectedIndex = -1
        ComboBox5.SelectedIndex = -1

    End Sub
End Class














                                        ----------------------------------------------------------------------------
                                                                     VIP PERKS
                                        ----------------------------------------------------------------------------














Imports MySql.Data.MySqlClient

Public Class vip_perks
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM vip_perks"
            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = table

        Catch ex As Exception
            MsgBox("Error refreshing data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub


    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Dim perkID = Val(ComboBox1.SelectedItem)

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"SELECT * FROM vip_perks WHERE vip_perk_id = {perkID}"
            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = table

        Catch ex As Exception
            MsgBox("Error searching data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub


    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Dim perkID = Val(ComboBox1.Text)
        Dim perkName = TextBox1.Text.Trim()

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"INSERT INTO vip_perks (vip_perk_name) VALUES ('{perkName}')"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If i > 0 Then
                MsgBox("Perk inserted successfully.")
                sql = "SELECT vip_perk_id FROM vip_perks"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()

                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("vip_perk_id").ToString())
                End While
                dbread.Close()

            Else
                MsgBox("Insert failed.")
            End If

        Catch ex As Exception
            MsgBox("Error inserting record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub


    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim perkID = Val(ComboBox1.Text)
        Dim perkName = TextBox1.Text.Trim()

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"UPDATE vip_perks SET vip_perk_name = '{perkName}' WHERE vip_perk_id = {perkID}"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If i > 0 Then
                MsgBox("Perk updated successfully.")
            Else
                MsgBox("Update failed.")
            End If

        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub


    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Dim perkID = Val(ComboBox1.Text)

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim ans = MessageBox.Show("Do you want to delete this perk?", "Confirm Delete", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM vip_perks WHERE vip_perk_id = {perkID}"
                dbcomm = New MySqlCommand(sql, conn)
                Dim i As Integer = dbcomm.ExecuteNonQuery

                If i > 0 Then
                    MsgBox("Perk deleted successfully.")
                Else
                    MsgBox("Delete failed.")
                End If
            End If

        Catch ex As Exception
            MsgBox("Error deleting record: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub vip_perks_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM vip_perks"
            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = table

            ComboBox1.Items.Clear()
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("vip_perk_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Dim perkID = Val(ComboBox1.Text)
        Try
            conn.Open()
            sql = "SELECT * FROM vip_perks WHERE vip_perk_id = " & perkID

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            If dbread.Read() Then
                TextBox1.Text = dbread("vip_perk_name").ToString()
            End If
            dbread.Close()

        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)

        End Try
        conn.Close()
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        ComboBox1.SelectedIndex = -1
        TextBox1.Clear()
    End Sub
End Class




















                                        ----------------------------------------------------------------------------
                                                     VIP FOOD ORDERLINE
                                        ----------------------------------------------------------------------------






Imports MySql.Data.MySqlClient
Public Class supplier_transactions
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()
    Private Sub supplier_transactions_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM supplier_transactions"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "supplier_transactions")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "supplier_transactions"

            sql = "SELECT transaction_id FROM supplier_transactions ORDER BY transaction_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            While dbread.Read()
                ComboBox1.Items.Add(dbread("transaction_id"))
            End While
            dbread.Close()

            sql = "SELECT supplier_id FROM suppliers ORDER BY supplier_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox2.Items.Clear()
            While dbread.Read()
                ComboBox2.Items.Add(dbread("supplier_id"))
            End While
            dbread.Close()

            sql = "SELECT equipment_id FROM equipment_inventory ORDER BY equipment_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox4.Items.Clear()
            While dbread.Read()
                ComboBox4.Items.Add(dbread("equipment_id"))
            End While
            dbread.Close()

            sql = "SELECT food_id FROM food_inventory ORDER BY food_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox3.Items.Clear()
            While dbread.Read()
                ComboBox3.Items.Add(dbread("food_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
        ComboBox6.Items.Clear()
        ComboBox6.Items.Add("Food")
        ComboBox6.Items.Add("Equipment")
        ComboBox6.SelectedIndex = 0

        ComboBox5.Items.Clear()
        ComboBox5.Items.Add("Delivered")
        ComboBox5.Items.Add("Cancelled")
        ComboBox5.SelectedIndex = 0
    End Sub


    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Dim transactionID As String = ComboBox1.Text
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM supplier_transactions WHERE transaction_id = '" & transactionID & "'"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            If dbread.HasRows Then
                dbread.Read()

                TextBox1.Text = dbread("shipping_fee").ToString()
                TextBox2.Text = dbread("purchase_amount").ToString()
                TextBox3.Text = dbread("quantity").ToString()
                ComboBox5.Text = dbread("status").ToString()
                ComboBox2.Text = dbread("supplier_id").ToString()
                ComboBox6.Text = dbread("supplier_type").ToString()

                If Not IsDBNull(dbread("date_delivered")) Then
                    DateTimePicker1.Value = Convert.ToDateTime(dbread("date_delivered"))
                Else
                    DateTimePicker1.Value = DateTime.Now
                End If
            Else
                MsgBox("No data found for Transaction ID " & transactionID)
            End If

        Catch ex As MySqlException
            MsgBox("MySQL Error: " & ex.Message)
        Catch ex As Exception
            MsgBox("General Error: " & ex.Message)
        Finally
            If dbread IsNot Nothing AndAlso Not dbread.IsClosed Then dbread.Close()
            If conn.State = ConnectionState.Open Then conn.Close()
        End Try
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()
            Dim query As String = "SELECT * FROM supplier_transactions"
            adapter = New MySqlDataAdapter(query, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim transactionID As Integer = Val(ComboBox1.SelectedItem)
            Dim suppliertype As String = ComboBox6.SelectedItem.ToString()

            If transactionID = 0 OrElse String.IsNullOrWhiteSpace(suppliertype) Then
                MsgBox("Please select a valid transaction and supplier type.")
                Exit Sub
            End If

            If suppliertype = "Food" Then
                sql = "SELECT st.transaction_id, st.supplier_id, ft.food_id, st.supplier_type, st.date_delivered, st.shipping_fee, " &
                  "st.purchase_amount, st.quantity, st.status " &
                  "FROM supplier_transactions st " &
                  "INNER JOIN food_transaction_details ft ON st.transaction_id = ft.transaction_id " &
                  "WHERE st.transaction_id = " & transactionID
            ElseIf suppliertype = "Equipment" Then
                sql = "SELECT st.transaction_id, st.supplier_id, et.equipment_id, st.supplier_type, st.date_delivered, st.shipping_fee, " &
                  "st.purchase_amount, st.quantity, st.status " &
                  "FROM supplier_transactions st " &
                  "INNER JOIN equipment_transaction_details et ON st.transaction_id = et.transaction_id " &
                  "WHERE st.transaction_id = " & transactionID
            Else
                MsgBox("Invalid supplier type selected.")
                Exit Sub
            End If

            adapter = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            adapter.Fill(ds, "supplier_transactions")

            DataGridView1.DataSource = ds.Tables("supplier_transactions")

        Catch ex As Exception
            MsgBox("Error collecting data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub





    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim shipping As Decimal = Convert.ToDecimal(TextBox1.Text)
            Dim purchase As Decimal = Convert.ToDecimal(TextBox2.Text)
            Dim supplierID = Val(ComboBox2.Text)
            Dim foodID = Val(ComboBox3.Text)
            Dim equipmentID = Val(ComboBox4.Text)
            Dim date_d = DateTimePicker1.Value.ToString("yyyy-MM-dd")
            Dim quantity = Val(TextBox3.Text)
            Dim status = ComboBox5.Text
            Dim suppliertype = ComboBox6.Text
            Dim transactionID As Integer
            Dim i As Integer = 0

            sql = $"INSERT INTO supplier_transactions (supplier_id, supplier_type, date_delivered, shipping_fee, purchase_amount, quantity, status) " &
              $"VALUES({supplierID}, '{suppliertype}', '{date_d}', {shipping}, {purchase}, {quantity}, '{status}')"

            dbcomm = New MySqlCommand(sql, conn)
            i = dbcomm.ExecuteNonQuery()

            If i > 0 Then
                MsgBox("Transaction record saved successfully.")

                sql = "SELECT LAST_INSERT_ID()"
                dbcomm = New MySqlCommand(sql, conn)
                transactionID = Convert.ToInt32(dbcomm.ExecuteScalar())

                If suppliertype = "Equipment" Then
                    sql = $"INSERT INTO equipment_transaction_details (transaction_id, equipment_id) VALUES({transactionID}, {equipmentID})"
                ElseIf suppliertype = "Food" Then
                    sql = $"INSERT INTO food_transaction_details (transaction_id, food_id) VALUES({transactionID}, {foodID})"
                End If

                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery()

                If i > 0 Then
                    MsgBox("Detail record saved successfully.")

                Else
                    MsgBox("Detail record not saved.")
                End If
            Else
                MsgBox("Transaction record not saved.")
            End If

        Catch ex As MySqlException
            MsgBox("Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub


    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim shipping As Decimal = Convert.ToDecimal(TextBox1.Text)
            Dim purchase As Decimal = Convert.ToDecimal(TextBox2.Text)
            Dim transactionID = Val(ComboBox1.SelectedItem)
            Dim supplierID = Val(ComboBox2.SelectedItem)
            Dim foodID = Val(ComboBox3.SelectedItem)
            Dim equipmentID = Val(ComboBox4.SelectedItem)
            Dim date_d = DateTimePicker1.Value.ToString("yyyy-MM-dd")
            Dim quantity = Val(TextBox3.Text)
            Dim status = ComboBox5.SelectedItem
            Dim suppliertype = ComboBox6.SelectedItem

            sql = $"UPDATE supplier_transactions SET supplier_id = {supplierID}, supplier_type = '{suppliertype}', 
           date_delivered = '{date_d}', shipping_fee = {shipping}, purchase_amount = {purchase}, quantity = {quantity} , status = '{status}' WHERE transaction_id = 
           {transactionID}"

            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery

            If (i > 0) Then
                MsgBox("record updated")
            Else
                MsgBox("record not updated")
            End If

            If suppliertype = "Equipment" Then
                sql = $"UPDATE equipment_transaction_details SET equipment_id = {equipmentID} WHERE transaction_id = {transactionID}"

                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("Record saved successfully.")
                Else
                    MsgBox("Record not saved.")
                End If
            ElseIf suppliertype = "Food" Then
                sql = $"UPDATE food_transaction_details SET food_id = {foodID} WHERE transaction_id = {transactionID}"

                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("Record saved successfully.")
                Else
                    MsgBox("Record not saved.")
                End If
            End If

        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
            conn.Close()
        End Try

    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Dim transactionID As Integer = Val(ComboBox1.SelectedItem)
        Dim status As String = ComboBox5.Text
        Dim i As Integer

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            If status = "Cancelled" Then
                Dim ans = MessageBox.Show("Do you want to delete this record?", "Confirm Deletion", MessageBoxButtons.YesNoCancel, MessageBoxIcon.Warning)
                If ans = DialogResult.Yes Then
                    sql = "DELETE FROM supplier_transactions WHERE transaction_id = " & transactionID
                    dbcomm = New MySqlCommand(sql, conn)
                    i = dbcomm.ExecuteNonQuery()

                    If i > 0 Then
                        MsgBox("Supplier transaction deleted successfully.")
                    Else
                        MsgBox("No transaction was deleted.")
                    End If
                End If
            Else
                MsgBox("Only transactions with status 'Cancelled' can be deleted.")
            End If

        Catch ex As MySqlException
            MsgBox("Database error: " & ex.Message)
        Catch ex As Exception
            MsgBox("Unexpected error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        TextBox1.Clear()
        TextBox2.Clear()
        TextBox3.Clear()
        ComboBox1.SelectedIndex = -1
        ComboBox2.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
        ComboBox4.SelectedIndex = -1
        ComboBox5.SelectedIndex = -1
        ComboBox6.SelectedIndex = -1
        DateTimePicker1.Value = DateTime.Now
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub
End Class







                                        ----------------------------------------------------------------------------
                                                                       EXPENSES
                                        ----------------------------------------------------------------------------







Imports MySql.Data.MySqlClient

Public Class expenses

    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()
    Private Sub expenses_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            conn.Open()

            sql = $"SELECT * FROM expenses"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "expenses")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "expenses"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("expense_id"))
            End While
            dbread.Close()

            sql = "SELECT transaction_id FROM supplier_transactions ORDER BY transaction_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox2.Items.Clear()
            While dbread.Read()
                ComboBox2.Items.Add(dbread("transaction_id"))
            End While
            dbread.Close()


        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try

        ComboBox3.Items.Clear()
        ComboBox3.Items.Add("Food")
        ComboBox3.Items.Add("Equipment")
        ComboBox3.SelectedIndex = 0
    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        Dim expID = Val(ComboBox1.SelectedItem)
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"SELECT * FROM expenses WHERE expense_id = {expID}"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            If dbread.Read() Then
                TextBox1.Text = dbread("amount")
                DateTimePicker1.Value = Convert.ToDateTime(dbread("date_incurred"))
                ComboBox2.Text = dbread("transaction_id")
                ComboBox3.Text = dbread("expense_type")
            End If
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading equipment data: " & ex.Message, MsgBoxStyle.Critical)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            conn.Open()
            Dim query As String = "SELECT * FROM expenses"

            adapter = New MySqlDataAdapter(query, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = Nothing
            DataGridView1.DataSource = table
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            Dim expID = Val(ComboBox1.SelectedItem)
            conn.Open()

            sql = $"SELECT * FROM expenses WHERE expense_id = {expID}"

            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "expenses")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "expenses"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            While dbread.Read()
                ComboBox1.Items.Add(dbread("expense_id"))
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error in collecting data from Database. Error is :" & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Try
            Dim i As Integer = 0
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim transID = Val(ComboBox2.SelectedItem)
            Dim type = ComboBox3.SelectedItem.ToString()
            Dim dateinc = DateTimePicker1.Value.ToString("yyyy-MM-dd")
            Dim amount As Decimal = 0

            sql = "SELECT shipping_fee, purchase_amount FROM supplier_transactions WHERE transaction_id = " & transID
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            If dbread.Read() Then
                Dim shippingFee As Decimal = Convert.ToDecimal(dbread("shipping_fee"))
                Dim purchaseAmount As Decimal = Convert.ToDecimal(dbread("purchase_amount"))
                amount = shippingFee + purchaseAmount
                TextBox1.Text = amount.ToString("F2")
            Else
                MsgBox("Transaction not found.")
                dbread.Close()
                conn.Close()
                Exit Sub
            End If
            dbread.Close()

            sql = $"INSERT INTO expenses (transaction_id, expense_type, amount, date_incurred) " &
              $"VALUES({transID}, '{type}', {amount.ToString("F2")}, '{dateinc}')"
            dbcomm = New MySqlCommand(sql, conn)
            i = dbcomm.ExecuteNonQuery()

            If i > 0 Then
                MsgBox("Expense added successfully.")

                sql = "SELECT expense_id FROM expenses ORDER BY expense_id ASC"
                dbcomm = New MySqlCommand(sql, conn)
                dbread = dbcomm.ExecuteReader()

                ComboBox1.Items.Clear()
                While dbread.Read()
                    ComboBox1.Items.Add(dbread("expense_id").ToString())
                End While
                dbread.Close()
            Else
                MsgBox("Expense not added.")
            End If

        Catch ex As Exception
            MsgBox("Insertion Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub




    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Try
            Dim expID = Val(ComboBox1.SelectedItem)
            Dim transID = Val(ComboBox2.SelectedItem)
            Dim type = ComboBox3.SelectedItem.ToString()
            Dim amount = Convert.ToDecimal(TextBox1.Text)
            Dim dateinc = DateTimePicker1.Value.ToString("yyyy-MM-dd")

            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = $"UPDATE expenses SET transaction_id = {transID}, expense_type = '{type}', amount = {amount}, date_incurred = {dateinc}
WHERE expense_id = {expID}"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery
            conn.Close()

            If (i > 0) Then
                MsgBox("record updated")
            Else
                MsgBox("record not updated")
            End If
        Catch ex As Exception
            MsgBox("Error updating record: " & ex.Message)
        End Try
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        Dim i As Integer
        Dim expID = Val(ComboBox1.SelectedItem)
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim ans = MessageBox.Show("do you want to delete this record?", "record deleted", MessageBoxButtons.YesNoCancel)
            If ans = DialogResult.Yes Then
                sql = $"DELETE FROM expenses WHERE expense_id = {expID}"
                dbcomm = New MySqlCommand(sql, conn)
                i = dbcomm.ExecuteNonQuery

                If (i > 0) Then
                    MsgBox("record deleted")
                Else
                    MsgBox("record not deleted")
                End If
            End If
            TextBox1.Clear()
            ComboBox1.SelectedIndex = -1
            ComboBox2.SelectedIndex = -1
            ComboBox3.SelectedIndex = -1
            DateTimePicker1.Value = DateTime.Now
        Catch ex As MySqlException
            MsgBox(ex.Message)
        Catch ex As Exception
            MsgBox(ex.Message)

        End Try
        conn.Close()
    End Sub

    Private Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        TextBox1.Clear()
        ComboBox1.SelectedIndex = -1
        ComboBox2.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
        DateTimePicker1.Value = DateTime.Now
    End Sub

    Private Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        Me.Hide()
        admin_buttons.Show()
    End Sub
End Class






                                        ----------------------------------------------------------------------------
                                                                            SALES
                                        ----------------------------------------------------------------------------








Imports MySql.Data.MySqlClient

Public Class sales
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        If ComboBox2.Text = "" Or ComboBox3.Text = "" Then
            MsgBox("Please select both Payment ID and Action.")
            Exit Sub
        End If

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim paymentID = Val(ComboBox2.Text)
            Dim action = ComboBox3.Text
            Dim timestamp = DateTimePicker1.Value.ToString("yyyy-MM-dd HH:mm:ss")
            Dim totalAmount, vatAmount, netAmount As Decimal

            sql = "SELECT amount_paid FROM customer_payments WHERE payment_id = " & paymentID
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            If dbread.Read() Then
                totalAmount = Convert.ToDecimal(dbread("amount_paid"))
                vatAmount = totalAmount * 0.12D
                netAmount = totalAmount - vatAmount
                TextBox1.Text = totalAmount.ToString("F2")
                TextBox2.Text = vatAmount.ToString("F2")
                TextBox3.Text = netAmount.ToString("F2")
            Else
                MsgBox("Payment not found.")
                dbread.Close()
                conn.Close()
                Exit Sub
            End If
            dbread.Close()

            sql = "INSERT INTO sales (payment_id, action, total_amount, vat_amount, net_amount, timestamp) " &
                  "VALUES(" & paymentID & ", '" & action & "', " & totalAmount.ToString("F2") & ", " & vatAmount.ToString("F2") & ", " & netAmount.ToString("F2") & ", '" & timestamp & "')"
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery()

            If i > 0 Then
                MsgBox("Sale record inserted successfully.")
                RefreshSales()
            Else
                MsgBox("Insert failed.")
            End If

        Catch ex As Exception
            MsgBox("Insert Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        RefreshSales()
    End Sub

    Private Sub RefreshSales()
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM sales"
            adapter = New MySqlDataAdapter(sql, conn)
            table.Clear()
            adapter.Fill(table)
            DataGridView1.DataSource = table

        Catch ex As Exception
            MsgBox("Refresh Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        If ComboBox1.Text = "" Then
            MsgBox("Please select a sale ID.")
            Exit Sub
        End If

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim saleID = Val(ComboBox1.Text)
            sql = "SELECT * FROM sales WHERE sale_id = " & saleID
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            If dbread.Read() Then
                ComboBox2.Text = dbread("payment_id").ToString()
                ComboBox3.Text = dbread("action").ToString()
                TextBox1.Text = dbread("total_amount").ToString()
                TextBox2.Text = dbread("vat_amount").ToString()
                TextBox3.Text = dbread("net_amount").ToString()
                DateTimePicker1.Value = Convert.ToDateTime(dbread("timestamp"))
            Else
                MsgBox("Sale not found.")
            End If
            dbread.Close()

        Catch ex As Exception
            MsgBox("Search Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        If ComboBox1.Text = "" Then
            MsgBox("Please select a sale ID to update.")
            Exit Sub
        End If

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim saleID = Val(ComboBox1.Text)
            Dim paymentID = Val(ComboBox2.Text)
            Dim action = ComboBox3.Text
            Dim totalAmount = Convert.ToDecimal(TextBox1.Text)
            Dim vatAmount = Convert.ToDecimal(TextBox2.Text)
            Dim netAmount = Convert.ToDecimal(TextBox3.Text)
            Dim timestamp = DateTimePicker1.Value.ToString("yyyy-MM-dd HH:mm:ss")

            sql = "UPDATE sales SET payment_id = " & paymentID & ", action = '" & action & "', total_amount = " & totalAmount & ", " &
                  "vat_amount = " & vatAmount & ", net_amount = " & netAmount & ", timestamp = '" & timestamp & "' WHERE sale_id = " & saleID
            dbcomm = New MySqlCommand(sql, conn)
            Dim i As Integer = dbcomm.ExecuteNonQuery()

            If i > 0 Then
                MsgBox("Sale record updated.")
                RefreshSales()
            Else
                MsgBox("Update failed.")
            End If

        Catch ex As Exception
            MsgBox("Update Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        ComboBox1.SelectedIndex = -1
        ComboBox2.SelectedIndex = -1
        ComboBox3.SelectedIndex = -1
        TextBox1.Clear()
        TextBox2.Clear()
        TextBox3.Clear()
        DateTimePicker1.Value = DateTime.Now
    End Sub

    Private Sub ComboBox1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ComboBox1.SelectedIndexChanged
        If ComboBox1.Text = "" Then Exit Sub

        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim saleID = Val(ComboBox1.Text)
            sql = "SELECT * FROM sales WHERE sale_id = " & saleID
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()

            If dbread.Read() Then
                TextBox1.Text = dbread("total_amount").ToString()
                TextBox2.Text = dbread("vat_amount").ToString()
                TextBox3.Text = dbread("net_amount").ToString()
                ComboBox2.Text = dbread("payment_id").ToString()
                ComboBox3.Text = dbread("action").ToString()
                DateTimePicker1.Value = Convert.ToDateTime(dbread("timestamp"))
            End If
            dbread.Close()

        Catch ex As Exception
            MsgBox("ComboBox1 Error: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

    Private Sub sales_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            sql = "SELECT * FROM sales"
            DataAdapter1 = New MySqlDataAdapter(sql, conn)
            ds = New DataSet()
            DataAdapter1.Fill(ds, "sales")
            DataGridView1.DataSource = ds
            DataGridView1.DataMember = "sales"

            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox1.Items.Clear()
            While dbread.Read()
                ComboBox1.Items.Add(dbread("sale_id").ToString())
            End While
            dbread.Close()

            sql = "SELECT payment_id FROM customer_payments ORDER BY payment_id ASC"
            dbcomm = New MySqlCommand(sql, conn)
            dbread = dbcomm.ExecuteReader()
            ComboBox2.Items.Clear()
            While dbread.Read()
                ComboBox2.Items.Add(dbread("payment_id").ToString())
            End While
            dbread.Close()

        Catch ex As Exception
            MsgBox("Error loading data: " & ex.Message)
        Finally
            conn.Close()
        End Try

        ComboBox3.Items.Clear()
        ComboBox3.Items.Add("Reservation")
        ComboBox3.Items.Add("Order")
        ComboBox3.Items.Add("VIP")
        ComboBox3.Items.Add("Cancellation Fee")
        ComboBox3.SelectedIndex = 0
    End Sub
End Class







                                        ----------------------------------------------------------------------------
                                                      INCOME
                                        ----------------------------------------------------------------------------








Imports MySql.Data.MySqlClient

Public Class finance
    Public conn As New MySqlConnection("server=localhost;user id=root;password=;database=KTV_Database_System")
    Public sql As String
    Public dbcomm As MySqlCommand
    Public dbread As MySqlDataReader
    Public DataAdapter1 As MySqlDataAdapter
    Public ds As DataSet
    Public adapter As MySqlDataAdapter
    Public table As DataTable = New DataTable()
    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim totalSales As Decimal = 0
            Dim totalExpenses As Decimal = 0

            sql = "SELECT SUM(net_amount) FROM sales"
            dbcomm = New MySqlCommand(sql, conn)
            totalSales = Convert.ToDecimal(dbcomm.ExecuteScalar())

            sql = "SELECT SUM(amount) FROM expenses"
            dbcomm = New MySqlCommand(sql, conn)
            totalExpenses = Convert.ToDecimal(dbcomm.ExecuteScalar())

            Dim income As Decimal = totalSales - totalExpenses
            TextBox2.Text = "Total Income: " & income.ToString("F2")

        Catch ex As Exception
            MsgBox("Error calculating income: " & ex.Message)
        Finally
            conn.Close()
        End Try

    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            If conn.State = ConnectionState.Open Then conn.Close()
            conn.Open()

            Dim startDate = DateTimePicker1.Value.ToString("yyyy-MM-dd")
            Dim endDate = DateTimePicker2.Value.ToString("yyyy-MM-dd")

            Dim rangeSales As Decimal = 0
            Dim rangeExpenses As Decimal = 0

            sql = $"SELECT SUM(net_amount) FROM sales WHERE DATE(timestamp) BETWEEN '{startDate}' AND '{endDate}'"
            dbcomm = New MySqlCommand(sql, conn)
            rangeSales = Convert.ToDecimal(dbcomm.ExecuteScalar())

            sql = $"SELECT SUM(amount) FROM expenses WHERE DATE(date_incurred) BETWEEN '{startDate}' AND '{endDate}'"
            dbcomm = New MySqlCommand(sql, conn)
            rangeExpenses = Convert.ToDecimal(dbcomm.ExecuteScalar())

            Dim income As Decimal = rangeSales - rangeExpenses
            TextBox1.Text = $"Income from {startDate} to {endDate}: " & income.ToString("F2")

        Catch ex As Exception
            MsgBox("Error calculating range income: " & ex.Message)
        Finally
            conn.Close()
        End Try
    End Sub

End Class
